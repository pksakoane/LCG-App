import { Injectable } from '@angular/core';
import { LocationStrategy } from '@angular/common';
import { DefaultUrlSerializer } from '@angular/router';
import { NativeScriptDebug } from '../trace';
import { isPresent } from '../lang-facade';
import { FrameService } from '../frame.service';
import { Outlet, defaultNavOptions } from './ns-location-utils';
import * as i0 from "@angular/core";
import * as i1 from "../frame.service";
export class NSLocationStrategy extends LocationStrategy {
    constructor(frameService) {
        super();
        this.frameService = frameService;
        this.outlets = [];
        this.popStateCallbacks = new Array();
        this._modalNavigationDepth = 0;
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.constructor()');
        }
    }
    path() {
        if (!this.currentUrlTree) {
            return '/';
        }
        const state = this.currentOutlet && this.currentOutlet.peekState();
        if (!state) {
            return '/';
        }
        let tree = this.currentUrlTree;
        let changedOutlet = this.getSegmentGroupByOutlet(this.currentOutlet);
        // Handle case where the user declares a component at path "/".
        // The url serializer doesn't parse this url as having a primary outlet.
        if (state.isRootSegmentGroup) {
            tree.root = state.segmentGroup;
        }
        else if (changedOutlet) {
            this.updateSegmentGroup(tree.root, changedOutlet, state.segmentGroup);
        }
        const urlSerializer = new DefaultUrlSerializer();
        tree.queryParams = state.queryParams;
        const url = urlSerializer.serialize(tree);
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.path(): ' + url);
        }
        return url;
    }
    prepareExternalUrl(internal) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.prepareExternalUrl() internal: ' + internal);
        }
        return internal;
    }
    pushState(state, title, url, queryParams) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.pushState state: ' + `${state}, title: ${title}, url: ${url}, queryParams: ${queryParams}`);
        }
        this.pushStateInternal(state, title, url, queryParams);
    }
    pushStateInternal(state, title, url, queryParams) {
        const urlSerializer = new DefaultUrlSerializer();
        this.currentUrlTree = urlSerializer.parse(url);
        const urlTreeRoot = this.currentUrlTree.root;
        // Handle case where the user declares a component at path "/".
        // The url serializer doesn't parse this url as having a primary outlet.
        if (!Object.keys(urlTreeRoot.children).length) {
            const segmentGroup = this.currentUrlTree && this.currentUrlTree.root;
            const outletKey = this.getOutletKey(this.getSegmentGroupFullPath(segmentGroup), 'primary');
            const outlet = this.findOutlet(outletKey);
            if (outlet && this.updateStates(outlet, segmentGroup, this.currentUrlTree.queryParams)) {
                this.currentOutlet = outlet; // If states updated
            }
            else if (!outlet) {
                // tslint:disable-next-line:max-line-length
                const rootOutlet = this.createOutlet('primary', null, segmentGroup, null, null, this.currentUrlTree.queryParams);
                this.currentOutlet = rootOutlet;
            }
            this.currentOutlet.peekState().isRootSegmentGroup = true;
            return;
        }
        const queue = [];
        let currentTree = urlTreeRoot;
        while (currentTree) {
            Object.keys(currentTree.children).forEach((outletName) => {
                const currentSegmentGroup = currentTree.children[outletName];
                currentSegmentGroup.outlet = outletName;
                currentSegmentGroup.root = urlTreeRoot;
                const outletPath = this.getSegmentGroupFullPath(currentTree);
                let outletKey = this.getOutletKey(outletPath, outletName);
                let outlet = this.findOutlet(outletKey);
                const parentOutletName = currentTree.outlet || '';
                const parentOutletPath = this.getSegmentGroupFullPath(currentTree.parent);
                const parentOutletKey = this.getOutletKey(parentOutletPath, parentOutletName);
                const parentOutlet = this.findOutlet(parentOutletKey);
                const containsLastState = outlet && outlet.containsTopState(currentSegmentGroup.toString());
                if (!outlet) {
                    // tslint:disable-next-line:max-line-length
                    outlet = this.createOutlet(outletKey, outletPath, currentSegmentGroup, parentOutlet, this._modalNavigationDepth, this.currentUrlTree.queryParams);
                    this.currentOutlet = outlet;
                }
                else if (this._modalNavigationDepth > 0 && outlet.showingModal && !containsLastState) {
                    // Navigation inside modal view.
                    this.upsertModalOutlet(outlet, currentSegmentGroup, this.currentUrlTree.queryParams);
                }
                else {
                    outlet.parent = parentOutlet;
                    if (this.updateStates(outlet, currentSegmentGroup, this.currentUrlTree.queryParams)) {
                        this.currentOutlet = outlet; // If states updated
                    }
                }
                queue.push(currentSegmentGroup);
            });
            currentTree = queue.shift();
        }
    }
    replaceState(state, title, url, queryParams) {
        const states = this.currentOutlet && this.currentOutlet.states;
        if (states && states.length > 0) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('NSLocationStrategy.replaceState changing existing state: ' + `${state}, title: ${title}, url: ${url}, queryParams: ${queryParams}`);
            }
        }
        else {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('NSLocationStrategy.replaceState pushing new state: ' + `${state}, title: ${title}, url: ${url}, queryParams: ${queryParams}`);
            }
            this.pushStateInternal(state, title, url, queryParams);
        }
    }
    forward() {
        throw new Error('NSLocationStrategy.forward() - not implemented');
    }
    back(outlet, frame) {
        this.currentOutlet = outlet || this.currentOutlet;
        if (this.currentOutlet.isPageNavigationBack) {
            const states = this.currentOutlet.states;
            // We are navigating to the previous page
            // clear the stack until we get to a page navigation state
            let state = states.pop();
            let count = 1;
            if (frame) {
                while (state.frame && state.frame !== frame) {
                    state = states.pop();
                    count++;
                }
            }
            while (!state.isPageNavigation) {
                state = states.pop();
                count++;
            }
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog(`NSLocationStrategy.back() while navigating back. States popped: ${count}`);
            }
            this.callPopState(state, true);
        }
        else {
            let state = this.currentOutlet.peekState();
            if (state && state.isPageNavigation) {
                // This was a page navigation - so navigate through frame.
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.routerLog('NSLocationStrategy.back() while not navigating back but top' + ' state is page - will call frame.goBack()');
                }
                if (!outlet) {
                    const topmostFrame = this.frameService.getFrame();
                    this.currentOutlet = this.getOutletByFrame(topmostFrame) || this.currentOutlet;
                }
                const frameToBack = this.currentOutlet.getFrameToBack();
                if (frameToBack) {
                    frameToBack.goBack();
                }
            }
            else {
                // Nested navigation - just pop the state
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.routerLog('NSLocationStrategy.back() while not navigating back but top' + ' state is not page - just pop');
                }
                this.callPopState(this.currentOutlet.states.pop(), true);
            }
        }
    }
    canGoBack(outlet) {
        outlet = outlet || this.currentOutlet;
        return outlet.states.length > 1;
    }
    onPopState(fn) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.onPopState');
        }
        this.popStateCallbacks.push(fn);
    }
    getBaseHref() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.getBaseHref()');
        }
        return '';
    }
    callPopState(state, pop = true, outlet) {
        outlet = outlet || this.currentOutlet;
        const urlSerializer = new DefaultUrlSerializer();
        let changedOutlet = this.getSegmentGroupByOutlet(outlet);
        if (state && changedOutlet) {
            this.updateSegmentGroup(this.currentUrlTree.root, changedOutlet, state.segmentGroup);
        }
        else if (changedOutlet) {
            // when closing modal view there are scenarios (e.g. root viewContainerRef) when we need
            // to clean up the named page router outlet to make sure we will open the modal properly again if needed.
            this.updateSegmentGroup(this.currentUrlTree.root, changedOutlet, null);
        }
        const url = urlSerializer.serialize(this.currentUrlTree);
        const change = { url: url, pop: pop };
        for (let fn of this.popStateCallbacks) {
            fn(change);
        }
    }
    toString() {
        let result = [];
        this.outlets.forEach((outlet) => {
            const outletStates = outlet.states;
            const outletLog = outletStates
                // tslint:disable-next-line:max-line-length
                .map((v, i) => `${outlet.outletKeys}.${i}.[${v.isPageNavigation ? 'PAGE' : 'INTERNAL'}].[${outlet.modalNavigationDepth ? 'MODAL' : 'BASE'}] "${v.segmentGroup.toString()}"`)
                .reverse();
            result = result.concat(outletLog);
        });
        return result.join('\n');
    }
    // Methods for syncing with page navigation in PageRouterOutlet
    _beginBackPageNavigation(frame) {
        const outlet = this.getOutletByFrame(frame);
        if (!outlet || outlet.isPageNavigationBack) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerError('Attempted to call startGoBack while going back.');
            }
            return;
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.startGoBack()');
        }
        outlet.isPageNavigationBack = true;
        this.currentOutlet = outlet;
    }
    _finishBackPageNavigation(frame) {
        const outlet = this.getOutletByFrame(frame);
        if (!outlet || !outlet.isPageNavigationBack) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerError('Attempted to call endGoBack while not going back.');
            }
            return;
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.finishBackPageNavigation()');
        }
        outlet.isPageNavigationBack = false;
    }
    _beginModalNavigation(frame) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy._beginModalNavigation()');
        }
        this.currentOutlet = this.getOutletByFrame(frame) || this.currentOutlet;
        // It is possible to have frame, but not corresponding Outlet, if
        // showing modal dialog on app.component.ts ngOnInit() e.g. In that case
        // the modal is treated as none modal navigation.
        if (this.currentOutlet) {
            this.currentOutlet.showingModal = true;
            this._modalNavigationDepth++;
        }
    }
    _closeModalNavigation() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.closeModalNavigation()');
        }
        const isShowingModal = this._modalNavigationDepth > 0;
        if (isShowingModal) {
            this._modalNavigationDepth--;
        }
        // currentOutlet should be the one that corresponds to the topmost frame
        const topmostOutlet = this.getOutletByFrame(this.frameService.getFrame());
        const outlet = this.findOutletByModal(this._modalNavigationDepth, isShowingModal) || topmostOutlet;
        if (outlet) {
            this.currentOutlet = outlet;
            this.currentOutlet.showingModal = false;
            this.callPopState(this.currentOutlet.peekState(), false);
        }
    }
    _beginPageNavigation(frame) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy._beginPageNavigation()');
        }
        this.currentOutlet = this.getOutletByFrame(frame) || this.currentOutlet;
        const lastState = this.currentOutlet.peekState();
        if (lastState) {
            lastState.isPageNavigation = true;
        }
        const navOptions = this._currentNavigationOptions || defaultNavOptions;
        if (navOptions.clearHistory) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('NSLocationStrategy._beginPageNavigation clearing states history');
            }
            this.currentOutlet.states = [lastState];
        }
        this._currentNavigationOptions = undefined;
        return navOptions;
    }
    _setNavigationOptions(options) {
        this._currentNavigationOptions = {
            clearHistory: isPresent(options.clearHistory) ? options.clearHistory : false,
            animated: isPresent(options.animated) ? options.animated : true,
            transition: options.transition,
        };
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy._setNavigationOptions(' + `${JSON.stringify(this._currentNavigationOptions)})`);
        }
    }
    _getOutlets() {
        return this.outlets;
    }
    updateOutletFrame(outlet, frame, isEmptyOutletFrame) {
        const lastState = outlet.peekState();
        if (lastState && !lastState.frame && !isEmptyOutletFrame) {
            lastState.frame = frame;
        }
        if (!outlet.containsFrame(frame)) {
            outlet.frames.push(frame);
        }
        this.currentOutlet = outlet;
    }
    clearOutlet(frame) {
        this.outlets = this.outlets.filter((currentOutlet) => {
            let isEqualToCurrent;
            if (this.currentOutlet) {
                isEqualToCurrent = currentOutlet.pathByOutlets === this.currentOutlet.pathByOutlets;
            }
            // Remove outlet from the url tree.
            if (currentOutlet.containsFrame(frame) && !isEqualToCurrent) {
                this.callPopState(null, true, currentOutlet);
            }
            // Skip frames filtering since currentOutlet is <router-outlet> when no frames available.
            if (currentOutlet.frames.length && !currentOutlet.isNSEmptyOutlet) {
                currentOutlet.frames = currentOutlet.frames.filter((currentFrame) => currentFrame !== frame);
                return currentOutlet.frames.length;
            }
            return !currentOutlet.containsFrame(frame);
        });
    }
    getSegmentGroupFullPath(segmentGroup) {
        let fullPath = '';
        while (segmentGroup) {
            const url = segmentGroup.toString();
            if (fullPath) {
                fullPath = (url ? url + '/' : '') + fullPath;
            }
            else {
                fullPath = url;
            }
            segmentGroup = segmentGroup.parent;
        }
        return fullPath;
    }
    getRouteFullPath(currentRoute) {
        const outletName = currentRoute.outlet;
        let fullPath;
        currentRoute = currentRoute.parent;
        while (currentRoute) {
            const urls = currentRoute.url.value || currentRoute.url;
            let url = urls;
            if (Array.isArray(urls)) {
                url = url.join('/');
            }
            fullPath = fullPath ? (url ? url + '/' : url) + fullPath : url;
            currentRoute = currentRoute.parent;
        }
        return fullPath ? fullPath + '-' + outletName : outletName;
    }
    getPathByOutlets(urlSegmentGroup) {
        if (!urlSegmentGroup) {
            return '';
        }
        let pathToOutlet;
        let lastPath = urlSegmentGroup.outlet || 'primary';
        let parent = urlSegmentGroup.parent;
        while (parent && urlSegmentGroup.root !== parent) {
            if (parent && parent.outlet !== lastPath) {
                if (lastPath === 'primary') {
                    lastPath = parent.outlet;
                }
                else {
                    lastPath = parent.outlet;
                    pathToOutlet = lastPath + '-' + (pathToOutlet || urlSegmentGroup.outlet);
                }
            }
            parent = parent.parent;
        }
        return pathToOutlet || lastPath;
    }
    findOutlet(outletKey, activatedRouteSnapshot) {
        let outlet = this.outlets.find((currentOutlet) => {
            let equalModalDepth = currentOutlet.modalNavigationDepth === this._modalNavigationDepth;
            return equalModalDepth && currentOutlet.outletKeys.indexOf(outletKey) > -1;
        });
        // No Outlet with the given outletKey could happen when using nested unnamed p-r-o
        // primary -> primary -> prymary
        if (!outlet && activatedRouteSnapshot) {
            const pathByOutlets = this.getPathByOutlets(activatedRouteSnapshot);
            outlet = this.outlets.find((currentOutlet) => {
                let equalModalDepth = currentOutlet.modalNavigationDepth === this._modalNavigationDepth;
                return equalModalDepth && currentOutlet.pathByOutlets === pathByOutlets;
            });
        }
        return outlet;
    }
    findOutletByModal(modalNavigation, isShowingModal) {
        return this.outlets.find((outlet) => {
            let equalModalDepth = outlet.modalNavigationDepth === modalNavigation;
            return isShowingModal ? equalModalDepth && outlet.showingModal : equalModalDepth;
        });
    }
    getOutletByFrame(frame) {
        let outlet;
        for (let index = 0; index < this.outlets.length; index++) {
            const currentOutlet = this.outlets[index];
            if (currentOutlet.containsFrame(frame)) {
                outlet = currentOutlet;
                break;
            }
        }
        return outlet;
    }
    updateStates(outlet, currentSegmentGroup, queryParams) {
        const isNewPage = outlet.states.length === 0;
        const lastState = outlet.states[outlet.states.length - 1];
        const equalStateUrls = outlet.containsTopState(currentSegmentGroup.toString());
        const locationState = {
            segmentGroup: currentSegmentGroup,
            isRootSegmentGroup: false,
            isPageNavigation: isNewPage,
            queryParams: Object.assign({}, queryParams),
        };
        if (!lastState || !equalStateUrls) {
            outlet.states.push(locationState);
            // Update last state segmentGroup of parent Outlet.
            if (this._modalNavigationDepth === 0 && !outlet.showingModal) {
                this.updateParentsStates(outlet, currentSegmentGroup.parent);
            }
            return true;
        }
        return false;
    }
    updateParentsStates(outlet, newSegmentGroup) {
        let parentOutlet = outlet.parent;
        // Update parents lastState segmentGroups
        while (parentOutlet && newSegmentGroup) {
            const state = parentOutlet.peekState();
            if (state) {
                state.segmentGroup = newSegmentGroup;
                newSegmentGroup = newSegmentGroup.parent;
                parentOutlet = parentOutlet.parent;
            }
        }
    }
    // tslint:disable-next-line:max-line-length
    createOutlet(outletKey, path, segmentGroup, parent, modalNavigation, queryParams = {}) {
        const pathByOutlets = this.getPathByOutlets(segmentGroup);
        const newOutlet = new Outlet(outletKey, path, pathByOutlets, modalNavigation);
        const locationState = {
            segmentGroup: segmentGroup,
            isRootSegmentGroup: false,
            isPageNavigation: true,
            queryParams: Object.assign({}, queryParams),
        };
        newOutlet.states = [locationState];
        newOutlet.parent = parent;
        this.outlets.push(newOutlet);
        // Update last state segmentGroup of parent Outlet.
        if (this._modalNavigationDepth === 0 && !newOutlet.showingModal) {
            this.updateParentsStates(newOutlet, segmentGroup.parent);
        }
        return newOutlet;
    }
    getSegmentGroupByOutlet(outlet) {
        const pathList = outlet.pathByOutlets.split('-');
        let segmentGroup = this.currentUrlTree.root;
        let pathToOutlet;
        for (let index = 0; index < pathList.length; index++) {
            const currentPath = pathList[index];
            const childrenCount = Object.keys(segmentGroup.children).length;
            if (childrenCount && segmentGroup.children[currentPath]) {
                const url = segmentGroup.toString();
                pathToOutlet = pathToOutlet ? pathToOutlet + '/' + url : url;
                segmentGroup = segmentGroup.children[currentPath];
            }
            else {
                // If no child outlet found with the given name - forget about all previously found outlets.
                // example: seaching for 'primary-second-primary' shouldn't return 'primary-second'
                // if no 'primary' child available on 'second'.
                segmentGroup = null;
                break;
            }
        }
        // Paths should also match since there could be another Outlet
        // with the same pathByOutlets but different url path.
        if (segmentGroup && outlet.path && pathToOutlet && outlet.path !== pathToOutlet) {
            segmentGroup = null;
        }
        return segmentGroup;
    }
    // Traversal and replacement of segmentGroup.
    updateSegmentGroup(rootNode, oldSegmentGroup, newSegmentGroup) {
        const queue = [];
        let currentTree = rootNode;
        while (currentTree) {
            Object.keys(currentTree.children).forEach((outletName) => {
                if (currentTree.children[outletName] === oldSegmentGroup) {
                    if (newSegmentGroup) {
                        currentTree.children[outletName] = newSegmentGroup;
                    }
                    else {
                        delete currentTree.children[outletName];
                    }
                }
                queue.push(currentTree.children[outletName]);
            });
            currentTree = queue.shift();
        }
    }
    upsertModalOutlet(parentOutlet, segmentedGroup, queryParams) {
        let currentModalOutlet = this.findOutletByModal(this._modalNavigationDepth);
        // We want to treat every p-r-o as a standalone Outlet.
        if (!currentModalOutlet) {
            if (this._modalNavigationDepth > 1) {
                // The parent of the current Outlet should be the previous opened modal (if any).
                parentOutlet = this.findOutletByModal(this._modalNavigationDepth - 1);
            }
            // No currentModalOutlet available when opening 'primary' p-r-o.
            const outletName = 'primary';
            const outletPath = parentOutlet.peekState().segmentGroup.toString();
            const outletKey = this.getOutletKey(outletPath, outletName);
            // tslint:disable-next-line:max-line-length
            currentModalOutlet = this.createOutlet(outletKey, outletPath, segmentedGroup, parentOutlet, this._modalNavigationDepth, queryParams);
            this.currentOutlet = currentModalOutlet;
        }
        else if (this.updateStates(currentModalOutlet, segmentedGroup, queryParams)) {
            this.currentOutlet = currentModalOutlet; // If states updated
        }
    }
    getOutletKey(path, outletName) {
        return path ? path + '-' + outletName : outletName;
    }
    ngOnDestroy() {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('NSLocationStrategy.ngOnDestroy()');
        }
        this.outlets = [];
        this.currentOutlet = null;
    }
}
NSLocationStrategy.ɵprov = i0.ɵɵdefineInjectable({ factory: function NSLocationStrategy_Factory() { return new NSLocationStrategy(i0.ɵɵinject(i1.FrameService)); }, token: NSLocationStrategy, providedIn: "root" });
NSLocationStrategy.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
NSLocationStrategy.ctorParameters = () => [
    { type: FrameService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnMtbG9jYXRpb24tc3RyYXRlZ3kuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vIiwic291cmNlcyI6WyJyb3V0ZXIvbnMtbG9jYXRpb24tc3RyYXRlZ3kudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsb0JBQW9CLEVBQTRELE1BQU0saUJBQWlCLENBQUM7QUFFakgsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFFLE1BQU0sRUFBb0MsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7O0FBS2xHLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSxnQkFBZ0I7SUFVdkQsWUFBb0IsWUFBMEI7UUFDN0MsS0FBSyxFQUFFLENBQUM7UUFEVyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQVR0QyxZQUFPLEdBQWtCLEVBQUUsQ0FBQztRQUc1QixzQkFBaUIsR0FBRyxJQUFJLEtBQUssRUFBbUIsQ0FBQztRQUlsRCwwQkFBcUIsR0FBRyxDQUFDLENBQUM7UUFJaEMsSUFBSSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsRUFBRTtZQUNyQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsa0NBQWtDLENBQUMsQ0FBQztTQUNoRTtJQUNGLENBQUM7SUFFRCxJQUFJO1FBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDekIsT0FBTyxHQUFHLENBQUM7U0FDWDtRQUVELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuRSxJ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O0lBRUQsV0FBVztRQUNWLElBQUksaUJBQWlCLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDckMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7U0FDaEU7UUFFRCxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztJQUMzQixDQUFDOzs7O1lBcHBCRCxVQUFVLFNBQUM7Z0JBQ1gsVUFBVSxFQUFFLE1BQU07YUFDbEI7OztZQUxRLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2NhdGlvblN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IERlZmF1bHRVcmxTZXJpYWxpemVyLCBVcmxTZWdtZW50R3JvdXAsIFVybFRyZWUsIEFjdGl2YXRlZFJvdXRlU25hcHNob3QsIFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBGcmFtZSB9IGZyb20gJ0BuYXRpdmVzY3JpcHQvY29yZSc7XG5pbXBvcnQgeyBOYXRpdmVTY3JpcHREZWJ1ZyB9IGZyb20gJy4uL3RyYWNlJztcbmltcG9ydCB7IGlzUHJlc2VudCB9IGZyb20gJy4uL2xhbmctZmFjYWRlJztcbmltcG9ydCB7IEZyYW1lU2VydmljZSB9IGZyb20gJy4uL2ZyYW1lLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3V0bGV0LCBOYXZpZ2F0aW9uT3B0aW9ucywgTG9jYXRpb25TdGF0ZSwgZGVmYXVsdE5hdk9wdGlvbnMgfSBmcm9tICcuL25zLWxvY2F0aW9uLXV0aWxzJztcblxuQEluamVjdGFibGUoe1xuXHRwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIE5TTG9jYXRpb25TdHJhdGVneSBleHRlbmRzIExvY2F0aW9uU3RyYXRlZ3kge1xuXHRwcml2YXRlIG91dGxldHM6IEFycmF5PE91dGxldD4gPSBbXTtcblx0cHJpdmF0ZSBjdXJyZW50T3V0bGV0OiBPdXRsZXQ7XG5cblx0cHJpdmF0ZSBwb3BTdGF0ZUNhbGxiYWNrcyA9IG5ldyBBcnJheTwoXzogYW55KSA9PiBhbnk+KCk7XG5cdHByaXZhdGUgX2N1cnJlbnROYXZpZ2F0aW9uT3B0aW9uczogTmF2aWdhdGlvbk9wdGlvbnM7XG5cdHByaXZhdGUgY3VycmVudFVybFRyZWU6IFVybFRyZWU7XG5cblx0cHVibGljIF9tb2RhbE5hdmlnYXRpb25EZXB0aCA9IDA7XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSBmcmFtZVNlcnZpY2U6IEZyYW1lU2VydmljZSkge1xuXHRcdHN1cGVyKCk7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ05TTG9jYXRpb25TdHJhdGVneS5jb25zdHJ1Y3RvcigpJyk7XG5cdFx0fVxuXHR9XG5cblx0cGF0aCgpOiBzdHJpbmcge1xuXHRcdGlmICghdGhpcy5jdXJyZW50VXJsVHJlZSkge1xuXHRcdFx0cmV0dXJuICcvJztcblx0XHR9XG5cblx0XHRjb25zdCBzdGF0ZSA9IHRoaXMuY3VycmVudE91dGxldCAmJiB0aGlzLmN1cnJlbnRPdXRsZXQucGVla1N0YXRlKCk7XG5cdFx0aWYgKCFzdGF0ZSkge1xuXHRcdFx0cmV0dXJuICcvJztcblx0XHR9XG5cblx0XHRsZXQgdHJlZSA9IHRoaXMuY3VycmVudFVybFRyZWU7XG5cdFx0bGV0IGNoYW5nZWRPdXRsZXQgPSB0aGlzLmdldFNlZ21lbnRHcm91cEJ5T3V0bGV0KHRoaXMuY3VycmVudE91dGxldCk7XG5cblx0XHQvLyBIYW5kbGUgY2FzZSB3aGVyZSB0aGUgdXNlciBkZWNsYXJlcyBhIGNvbXBvbmVudCBhdCBwYXRoIFwiL1wiLlxuXHRcdC8vIFRoZSB1cmwgc2VyaWFsaXplciBkb2Vzbid0IHBhcnNlIHRoaXMgdXJsIGFzIGhhdmluZyBhIHByaW1hcnkgb3V0bGV0LlxuXHRcdGlmIChzdGF0ZS5pc1Jvb3RTZWdtZW50R3JvdXApIHtcblx0XHRcdHRyZWUucm9vdCA9IHN0YXRlLnNlZ21lbnRHcm91cDtcblx0XHR9IGVsc2UgaWYgKGNoYW5nZWRPdXRsZXQpIHtcblx0XHRcdHRoaXMudXBkYXRlU2VnbWVudEdyb3VwKHRyZWUucm9vdCwgY2hhbmdlZE91dGxldCwgc3RhdGUuc2VnbWVudEdyb3VwKTtcblx0XHR9XG5cblx0XHRjb25zdCB1cmxTZXJpYWxpemVyID0gbmV3IERlZmF1bHRVcmxTZXJpYWxpemVyKCk7XG5cdFx0dHJlZS5xdWVyeVBhcmFtcyA9IHN0YXRlLnF1ZXJ5UGFyYW1zO1xuXHRcdGNvbnN0IHVybCA9IHVybFNlcmlhbGl6ZXIuc2VyaWFsaXplKHRyZWUpO1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdOU0xvY2F0aW9uU3RyYXRlZ3kucGF0aCgpOiAnICsgdXJsKTtcblx0XHR9XG5cdFx0cmV0dXJuIHVybDtcblx0fVxuXG5cdHByZXBhcmVFeHRlcm5hbFVybChpbnRlcm5hbDogc3RyaW5nKTogc3RyaW5nIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LnByZXBhcmVFeHRlcm5hbFVybCgpIGludGVybmFsOiAnICsgaW50ZXJuYWwpO1xuXHRcdH1cblx0XHRyZXR1cm4gaW50ZXJuYWw7XG5cdH1cblxuXHRwdXNoU3RhdGUoc3RhdGU6IGFueSwgdGl0bGU6IHN0cmluZywgdXJsOiBzdHJpbmcsIHF1ZXJ5UGFyYW1zOiBzdHJpbmcpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LnB1c2hTdGF0ZSBzdGF0ZTogJyArIGAke3N0YXRlfSwgdGl0bGU6ICR7dGl0bGV9LCB1cmw6ICR7dXJsfSwgcXVlcnlQYXJhbXM6ICR7cXVlcnlQYXJhbXN9YCk7XG5cdFx0fVxuXHRcdHRoaXMucHVzaFN0YXRlSW50ZXJuYWwoc3RhdGUsIHRpdGxlLCB1cmwsIHF1ZXJ5UGFyYW1zKTtcblx0fVxuXG5cdHB1c2hTdGF0ZUludGVybmFsKHN0YXRlOiBhbnksIHRpdGxlOiBzdHJpbmcsIHVybDogc3RyaW5nLCBxdWVyeVBhcmFtczogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgdXJsU2VyaWFsaXplciA9IG5ldyBEZWZhdWx0VXJsU2VyaWFsaXplcigpO1xuXHRcdHRoaXMuY3VycmVudFVybFRyZWUgPSB1cmxTZXJpYWxpemVyLnBhcnNlKHVybCk7XG5cdFx0Y29uc3QgdXJsVHJlZVJvb3QgPSB0aGlzLmN1cnJlbnRVcmxUcmVlLnJvb3Q7XG5cblx0XHQvLyBIYW5kbGUgY2FzZSB3aGVyZSB0aGUgdXNlciBkZWNsYXJlcyBhIGNvbXBvbmVudCBhdCBwYXRoIFwiL1wiLlxuXHRcdC8vIFRoZSB1cmwgc2VyaWFsaXplciBkb2Vzbid0IHBhcnNlIHRoaXMgdXJsIGFzIGhhdmluZyBhIHByaW1hcnkgb3V0bGV0LlxuXHRcdGlmICghT2JqZWN0LmtleXModXJsVHJlZVJvb3QuY2hpbGRyZW4pLmxlbmd0aCkge1xuXHRcdFx0Y29uc3Qgc2VnbWVudEdyb3VwID0gdGhpcy5jdXJyZW50VXJsVHJlZSAmJiB0aGlzLmN1cnJlbnRVcmxUcmVlLnJvb3Q7XG5cdFx0XHRjb25zdCBvdXRsZXRLZXkgPSB0aGlzLmdldE91dGxldEtleSh0aGlzLmdldFNlZ21lbnRHcm91cEZ1bGxQYXRoKHNlZ21lbnRHcm91cCksICdwcmltYXJ5Jyk7XG5cdFx0XHRjb25zdCBvdXRsZXQgPSB0aGlzLmZpbmRPdXRsZXQob3V0bGV0S2V5KTtcblxuXHRcdFx0aWYgKG91dGxldCAmJiB0aGlzLnVwZGF0ZVN0YXRlcyhvdXRsZXQsIHNlZ21lbnRHcm91cCwgdGhpcy5jdXJyZW50VXJsVHJlZS5xdWVyeVBhcmFtcykpIHtcblx0XHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0ID0gb3V0bGV0OyAvLyBJZiBzdGF0ZXMgdXBkYXRlZFxuXHRcdFx0fSBlbHNlIGlmICghb3V0bGV0KSB7XG5cdFx0XHRcdC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcblx0XHRcdFx0Y29uc3Qgcm9vdE91dGxldCA9IHRoaXMuY3JlYXRlT3V0bGV0KCdwcmltYXJ5JywgbnVsbCwgc2VnbWVudEdyb3VwLCBudWxsLCBudWxsLCB0aGlzLmN1cnJlbnRVcmxUcmVlLnF1ZXJ5UGFyYW1zKTtcblx0XHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0ID0gcm9vdE91dGxldDtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0LnBlZWtTdGF0ZSgpLmlzUm9vdFNlZ21lbnRHcm91cCA9IHRydWU7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgcXVldWUgPSBbXTtcblx0XHRsZXQgY3VycmVudFRyZWUgPSA8YW55PnVybFRyZWVSb290O1xuXG5cdFx0d2hpbGUgKGN1cnJlbnRUcmVlKSB7XG5cdFx0XHRPYmplY3Qua2V5cyhjdXJyZW50VHJlZS5jaGlsZHJlbikuZm9yRWFjaCgob3V0bGV0TmFtZSkgPT4ge1xuXHRcdFx0XHRjb25zdCBjdXJyZW50U2VnbWVudEdyb3VwID0gY3VycmVudFRyZWUuY2hpbGRyZW5bb3V0bGV0TmFtZV07XG5cdFx0XHRcdGN1cnJlbnRTZWdtZW50R3JvdXAub3V0bGV0ID0gb3V0bGV0TmFtZTtcblx0XHRcdFx0Y3VycmVudFNlZ21lbnRHcm91cC5yb290ID0gdXJsVHJlZVJvb3Q7XG5cblx0XHRcdFx0Y29uc3Qgb3V0bGV0UGF0aCA9IHRoaXMuZ2V0U2VnbWVudEdyb3VwRnVsbFBhdGgoY3VycmVudFRyZWUpO1xuXHRcdFx0XHRsZXQgb3V0bGV0S2V5ID0gdGhpcy5nZXRPdXRsZXRLZXkob3V0bGV0UGF0aCwgb3V0bGV0TmFtZSk7XG5cdFx0XHRcdGxldCBvdXRsZXQgPSB0aGlzLmZpbmRPdXRsZXQob3V0bGV0S2V5KTtcblxuXHRcdFx0XHRjb25zdCBwYXJlbnRPdXRsZXROYW1lID0gY3VycmVudFRyZWUub3V0bGV0IHx8ICcnO1xuXHRcdFx0XHRjb25zdCBwYXJlbnRPdXRsZXRQYXRoID0gdGhpcy5nZXRTZWdtZW50R3JvdXBGdWxsUGF0aChjdXJyZW50VHJlZS5wYXJlbnQpO1xuXHRcdFx0XHRjb25zdCBwYXJlbnRPdXRsZXRLZXkgPSB0aGlzLmdldE91dGxldEtleShwYXJlbnRPdXRsZXRQYXRoLCBwYXJlbnRPdXRsZXROYW1lKTtcblx0XHRcdFx0Y29uc3QgcGFyZW50T3V0bGV0ID0gdGhpcy5maW5kT3V0bGV0KHBhcmVudE91dGxldEtleSk7XG5cblx0XHRcdFx0Y29uc3QgY29udGFpbnNMYXN0U3RhdGUgPSBvdXRsZXQgJiYgb3V0bGV0LmNvbnRhaW5zVG9wU3RhdGUoY3VycmVudFNlZ21lbnRHcm91cC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKCFvdXRsZXQpIHtcblx0XHRcdFx0XHQvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG5cdFx0XHRcdFx0b3V0bGV0ID0gdGhpcy5jcmVhdGVPdXRsZXQob3V0bGV0S2V5LCBvdXRsZXRQYXRoLCBjdXJyZW50U2VnbWVudEdyb3VwLCBwYXJlbnRPdXRsZXQsIHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoLCB0aGlzLmN1cnJlbnRVcmxUcmVlLnF1ZXJ5UGFyYW1zKTtcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSBvdXRsZXQ7XG5cdFx0XHRcdH0gZWxzZSBpZiAodGhpcy5fbW9kYWxOYXZpZ2F0aW9uRGVwdGggPiAwICYmIG91dGxldC5zaG93aW5nTW9kYWwgJiYgIWNvbnRhaW5zTGFzdFN0YXRlKSB7XG5cdFx0XHRcdFx0Ly8gTmF2aWdhdGlvbiBpbnNpZGUgbW9kYWwgdmlldy5cblx0XHRcdFx0XHR0aGlzLnVwc2VydE1vZGFsT3V0bGV0KG91dGxldCwgY3VycmVudFNlZ21lbnRHcm91cCwgdGhpcy5jdXJyZW50VXJsVHJlZS5xdWVyeVBhcmFtcyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b3V0bGV0LnBhcmVudCA9IHBhcmVudE91dGxldDtcblxuXHRcdFx0XHRcdGlmICh0aGlzLnVwZGF0ZVN0YXRlcyhvdXRsZXQsIGN1cnJlbnRTZWdtZW50R3JvdXAsIHRoaXMuY3VycmVudFVybFRyZWUucXVlcnlQYXJhbXMpKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSBvdXRsZXQ7IC8vIElmIHN0YXRlcyB1cGRhdGVkXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cXVldWUucHVzaChjdXJyZW50U2VnbWVudEdyb3VwKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjdXJyZW50VHJlZSA9IHF1ZXVlLnNoaWZ0KCk7XG5cdFx0fVxuXHR9XG5cblx0cmVwbGFjZVN0YXRlKHN0YXRlOiBhbnksIHRpdGxlOiBzdHJpbmcsIHVybDogc3RyaW5nLCBxdWVyeVBhcmFtczogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3Qgc3RhdGVzID0gdGhpcy5jdXJyZW50T3V0bGV0ICYmIHRoaXMuY3VycmVudE91dGxldC5zdGF0ZXM7XG5cblx0XHRpZiAoc3RhdGVzICYmIHN0YXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdOU0xvY2F0aW9uU3RyYXRlZ3kucmVwbGFjZVN0YXRlIGNoYW5naW5nIGV4aXN0aW5nIHN0YXRlOiAnICsgYCR7c3RhdGV9LCB0aXRsZTogJHt0aXRsZX0sIHVybDogJHt1cmx9LCBxdWVyeVBhcmFtczogJHtxdWVyeVBhcmFtc31gKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LnJlcGxhY2VTdGF0ZSBwdXNoaW5nIG5ldyBzdGF0ZTogJyArIGAke3N0YXRlfSwgdGl0bGU6ICR7dGl0bGV9LCB1cmw6ICR7dXJsfSwgcXVlcnlQYXJhbXM6ICR7cXVlcnlQYXJhbXN9YCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnB1c2hTdGF0ZUludGVybmFsKHN0YXRlLCB0aXRsZSwgdXJsLCBxdWVyeVBhcmFtcyk7XG5cdFx0fVxuXHR9XG5cblx0Zm9yd2FyZCgpOiB2b2lkIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ05TTG9jYXRpb25TdHJhdGVneS5mb3J3YXJkKCkgLSBub3QgaW1wbGVtZW50ZWQnKTtcblx0fVxuXG5cdGJhY2sob3V0bGV0PzogT3V0bGV0LCBmcmFtZT86IEZyYW1lKTogdm9pZCB7XG5cdFx0dGhpcy5jdXJyZW50T3V0bGV0ID0gb3V0bGV0IHx8IHRoaXMuY3VycmVudE91dGxldDtcblxuXHRcdGlmICh0aGlzLmN1cnJlbnRPdXRsZXQuaXNQYWdlTmF2aWdhdGlvbkJhY2spIHtcblx0XHRcdGNvbnN0IHN0YXRlcyA9IHRoaXMuY3VycmVudE91dGxldC5zdGF0ZXM7XG5cdFx0XHQvLyBXZSBhcmUgbmF2aWdhdGluZyB0byB0aGUgcHJldmlvdXMgcGFnZVxuXHRcdFx0Ly8gY2xlYXIgdGhlIHN0YWNrIHVudGlsIHdlIGdldCB0byBhIHBhZ2UgbmF2aWdhdGlvbiBzdGF0ZVxuXHRcdFx0bGV0IHN0YXRlID0gc3RhdGVzLnBvcCgpO1xuXHRcdFx0bGV0IGNvdW50ID0gMTtcblxuXHRcdFx0aWYgKGZyYW1lKSB7XG5cdFx0XHRcdHdoaWxlIChzdGF0ZS5mcmFtZSAmJiBzdGF0ZS5mcmFtZSAhPT0gZnJhbWUpIHtcblx0XHRcdFx0XHRzdGF0ZSA9IHN0YXRlcy5wb3AoKTtcblx0XHRcdFx0XHRjb3VudCsrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHdoaWxlICghc3RhdGUuaXNQYWdlTmF2aWdhdGlvbikge1xuXHRcdFx0XHRzdGF0ZSA9IHN0YXRlcy5wb3AoKTtcblx0XHRcdFx0Y291bnQrKztcblx0XHRcdH1cblxuXHRcdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZyhgTlNMb2NhdGlvblN0cmF0ZWd5LmJhY2soKSB3aGlsZSBuYXZpZ2F0aW5nIGJhY2suIFN0YXRlcyBwb3BwZWQ6ICR7Y291bnR9YCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmNhbGxQb3BTdGF0ZShzdGF0ZSwgdHJ1ZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxldCBzdGF0ZSA9IHRoaXMuY3VycmVudE91dGxldC5wZWVrU3RhdGUoKTtcblx0XHRcdGlmIChzdGF0ZSAmJiBzdGF0ZS5pc1BhZ2VOYXZpZ2F0aW9uKSB7XG5cdFx0XHRcdC8vIFRoaXMgd2FzIGEgcGFnZSBuYXZpZ2F0aW9uIC0gc28gbmF2aWdhdGUgdGhyb3VnaCBmcmFtZS5cblx0XHRcdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdOU0xvY2F0aW9uU3RyYXRlZ3kuYmFjaygpIHdoaWxlIG5vdCBuYXZpZ2F0aW5nIGJhY2sgYnV0IHRvcCcgKyAnIHN0YXRlIGlzIHBhZ2UgLSB3aWxsIGNhbGwgZnJhbWUuZ29CYWNrKCknKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghb3V0bGV0KSB7XG5cdFx0XHRcdFx0Y29uc3QgdG9wbW9zdEZyYW1lID0gdGhpcy5mcmFtZVNlcnZpY2UuZ2V0RnJhbWUoKTtcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSB0aGlzLmdldE91dGxldEJ5RnJhbWUodG9wbW9zdEZyYW1lKSB8fCB0aGlzLmN1cnJlbnRPdXRsZXQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb25zdCBmcmFtZVRvQmFjazogRnJhbWUgPSB0aGlzLmN1cnJlbnRPdXRsZXQuZ2V0RnJhbWVUb0JhY2soKTtcblx0XHRcdFx0aWYgKGZyYW1lVG9CYWNrKSB7XG5cdFx0XHRcdFx0ZnJhbWVUb0JhY2suZ29CYWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIE5lc3RlZCBuYXZpZ2F0aW9uIC0ganVzdCBwb3AgdGhlIHN0YXRlXG5cdFx0XHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LmJhY2soKSB3aGlsZSBub3QgbmF2aWdhdGluZyBiYWNrIGJ1dCB0b3AnICsgJyBzdGF0ZSBpcyBub3QgcGFnZSAtIGp1c3QgcG9wJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmNhbGxQb3BTdGF0ZSh0aGlzLmN1cnJlbnRPdXRsZXQuc3RhdGVzLnBvcCgpLCB0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRjYW5Hb0JhY2sob3V0bGV0PzogT3V0bGV0KSB7XG5cdFx0b3V0bGV0ID0gb3V0bGV0IHx8IHRoaXMuY3VycmVudE91dGxldDtcblx0XHRyZXR1cm4gb3V0bGV0LnN0YXRlcy5sZW5ndGggPiAxO1xuXHR9XG5cblx0b25Qb3BTdGF0ZShmbjogKF86IGFueSkgPT4gYW55KTogdm9pZCB7XG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ05TTG9jYXRpb25TdHJhdGVneS5vblBvcFN0YXRlJyk7XG5cdFx0fVxuXHRcdHRoaXMucG9wU3RhdGVDYWxsYmFja3MucHVzaChmbik7XG5cdH1cblxuXHRnZXRCYXNlSHJlZigpOiBzdHJpbmcge1xuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdOU0xvY2F0aW9uU3RyYXRlZ3kuZ2V0QmFzZUhyZWYoKScpO1xuXHRcdH1cblx0XHRyZXR1cm4gJyc7XG5cdH1cblxuXHRwcml2YXRlIGNhbGxQb3BTdGF0ZShzdGF0ZTogTG9jYXRpb25TdGF0ZSwgcG9wOiBib29sZWFuID0gdHJ1ZSwgb3V0bGV0PzogT3V0bGV0KSB7XG5cdFx0b3V0bGV0ID0gb3V0bGV0IHx8IHRoaXMuY3VycmVudE91dGxldDtcblx0XHRjb25zdCB1cmxTZXJpYWxpemVyID0gbmV3IERlZmF1bHRVcmxTZXJpYWxpemVyKCk7XG5cdFx0bGV0IGNoYW5nZWRPdXRsZXQgPSB0aGlzLmdldFNlZ21lbnRHcm91cEJ5T3V0bGV0KG91dGxldCk7XG5cblx0XHRpZiAoc3RhdGUgJiYgY2hhbmdlZE91dGxldCkge1xuXHRcdFx0dGhpcy51cGRhdGVTZWdtZW50R3JvdXAodGhpcy5jdXJyZW50VXJsVHJlZS5yb290LCBjaGFuZ2VkT3V0bGV0LCBzdGF0ZS5zZWdtZW50R3JvdXApO1xuXHRcdH0gZWxzZSBpZiAoY2hhbmdlZE91dGxldCkge1xuXHRcdFx0Ly8gd2hlbiBjbG9zaW5nIG1vZGFsIHZpZXcgdGhlcmUgYXJlIHNjZW5hcmlvcyAoZS5nLiByb290IHZpZXdDb250YWluZXJSZWYpIHdoZW4gd2UgbmVlZFxuXHRcdFx0Ly8gdG8gY2xlYW4gdXAgdGhlIG5hbWVkIHBhZ2Ugcm91dGVyIG91dGxldCB0byBtYWtlIHN1cmUgd2Ugd2lsbCBvcGVuIHRoZSBtb2RhbCBwcm9wZXJseSBhZ2FpbiBpZiBuZWVkZWQuXG5cdFx0XHR0aGlzLnVwZGF0ZVNlZ21lbnRHcm91cCh0aGlzLmN1cnJlbnRVcmxUcmVlLnJvb3QsIGNoYW5nZWRPdXRsZXQsIG51bGwpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHVybCA9IHVybFNlcmlhbGl6ZXIuc2VyaWFsaXplKHRoaXMuY3VycmVudFVybFRyZWUpO1xuXHRcdGNvbnN0IGNoYW5nZSA9IHsgdXJsOiB1cmwsIHBvcDogcG9wIH07XG5cdFx0Zm9yIChsZXQgZm4gb2YgdGhpcy5wb3BTdGF0ZUNhbGxiYWNrcykge1xuXHRcdFx0Zm4oY2hhbmdlKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgdG9TdHJpbmcoKSB7XG5cdFx0bGV0IHJlc3VsdCA9IFtdO1xuXG5cdFx0dGhpcy5vdXRsZXRzLmZvckVhY2goKG91dGxldCkgPT4ge1xuXHRcdFx0Y29uc3Qgb3V0bGV0U3RhdGVzID0gb3V0bGV0LnN0YXRlcztcblx0XHRcdGNvbnN0IG91dGxldExvZyA9IG91dGxldFN0YXRlc1xuXHRcdFx0XHQvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG5cdFx0XHRcdC5tYXAoKHYsIGkpID0+IGAke291dGxldC5vdXRsZXRLZXlzfS4ke2l9Llske3YuaXNQYWdlTmF2aWdhdGlvbiA/ICdQQUdFJyA6ICdJTlRFUk5BTCd9XS5bJHtvdXRsZXQubW9kYWxOYXZpZ2F0aW9uRGVwdGggPyAnTU9EQUwnIDogJ0JBU0UnfV0gXCIke3Yuc2VnbWVudEdyb3VwLnRvU3RyaW5nKCl9XCJgKVxuXHRcdFx0XHQucmV2ZXJzZSgpO1xuXG5cdFx0XHRyZXN1bHQgPSByZXN1bHQuY29uY2F0KG91dGxldExvZyk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmVzdWx0LmpvaW4oJ1xcbicpO1xuXHR9XG5cblx0Ly8gTWV0aG9kcyBmb3Igc3luY2luZyB3aXRoIHBhZ2UgbmF2aWdhdGlvbiBpbiBQYWdlUm91dGVyT3V0bGV0XG5cdHB1YmxpYyBfYmVnaW5CYWNrUGFnZU5hdmlnYXRpb24oZnJhbWU6IEZyYW1lKSB7XG5cdFx0Y29uc3Qgb3V0bGV0OiBPdXRsZXQgPSB0aGlzLmdldE91dGxldEJ5RnJhbWUoZnJhbWUpO1xuXG5cdFx0aWYgKCFvdXRsZXQgfHwgb3V0bGV0LmlzUGFnZU5hdmlnYXRpb25CYWNrKSB7XG5cdFx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyRXJyb3IoJ0F0dGVtcHRlZCB0byBjYWxsIHN0YXJ0R29CYWNrIHdoaWxlIGdvaW5nIGJhY2suJyk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG5cdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ05TTG9jYXRpb25TdHJhdGVneS5zdGFydEdvQmFjaygpJyk7XG5cdFx0fVxuXHRcdG91dGxldC5pc1BhZ2VOYXZpZ2F0aW9uQmFjayA9IHRydWU7XG5cblx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSBvdXRsZXQ7XG5cdH1cblxuXHRwdWJsaWMgX2ZpbmlzaEJhY2tQYWdlTmF2aWdhdGlvbihmcmFtZTogRnJhbWUpIHtcblx0XHRjb25zdCBvdXRsZXQ6IE91dGxldCA9IHRoaXMuZ2V0T3V0bGV0QnlGcmFtZShmcmFtZSk7XG5cblx0XHRpZiAoIW91dGxldCB8fCAhb3V0bGV0LmlzUGFnZU5hdmlnYXRpb25CYWNrKSB7XG5cdFx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyRXJyb3IoJ0F0dGVtcHRlZCB0byBjYWxsIGVuZEdvQmFjayB3aGlsZSBub3QgZ29pbmcgYmFjay4nKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LmZpbmlzaEJhY2tQYWdlTmF2aWdhdGlvbigpJyk7XG5cdFx0fVxuXHRcdG91dGxldC5pc1BhZ2VOYXZpZ2F0aW9uQmFjayA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIF9iZWdpbk1vZGFsTmF2aWdhdGlvbihmcmFtZTogRnJhbWUpOiB2b2lkIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5Ll9iZWdpbk1vZGFsTmF2aWdhdGlvbigpJyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5jdXJyZW50T3V0bGV0ID0gdGhpcy5nZXRPdXRsZXRCeUZyYW1lKGZyYW1lKSB8fCB0aGlzLmN1cnJlbnRPdXRsZXQ7XG5cblx0XHQvLyBJdCBpcyBwb3NzaWJsZSB0byBoYXZlIGZyYW1lLCBidXQgbm90IGNvcnJlc3BvbmRpbmcgT3V0bGV0LCBpZlxuXHRcdC8vIHNob3dpbmcgbW9kYWwgZGlhbG9nIG9uIGFwcC5jb21wb25lbnQudHMgbmdPbkluaXQoKSBlLmcuIEluIHRoYXQgY2FzZVxuXHRcdC8vIHRoZSBtb2RhbCBpcyB0cmVhdGVkIGFzIG5vbmUgbW9kYWwgbmF2aWdhdGlvbi5cblx0XHRpZiAodGhpcy5jdXJyZW50T3V0bGV0KSB7XG5cdFx0XHR0aGlzLmN1cnJlbnRPdXRsZXQuc2hvd2luZ01vZGFsID0gdHJ1ZTtcblx0XHRcdHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoKys7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIF9jbG9zZU1vZGFsTmF2aWdhdGlvbigpIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5LmNsb3NlTW9kYWxOYXZpZ2F0aW9uKCknKTtcblx0XHR9XG5cblx0XHRjb25zdCBpc1Nob3dpbmdNb2RhbCA9IHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoID4gMDtcblxuXHRcdGlmIChpc1Nob3dpbmdNb2RhbCkge1xuXHRcdFx0dGhpcy5fbW9kYWxOYXZpZ2F0aW9uRGVwdGgtLTtcblx0XHR9XG5cblx0XHQvLyBjdXJyZW50T3V0bGV0IHNob3VsZCBiZSB0aGUgb25lIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHRvcG1vc3QgZnJhbWVcblx0XHRjb25zdCB0b3Btb3N0T3V0bGV0ID0gdGhpcy5nZXRPdXRsZXRCeUZyYW1lKHRoaXMuZnJhbWVTZXJ2aWNlLmdldEZyYW1lKCkpO1xuXHRcdGNvbnN0IG91dGxldCA9IHRoaXMuZmluZE91dGxldEJ5TW9kYWwodGhpcy5fbW9kYWxOYXZpZ2F0aW9uRGVwdGgsIGlzU2hvd2luZ01vZGFsKSB8fCB0b3Btb3N0T3V0bGV0O1xuXG5cdFx0aWYgKG91dGxldCkge1xuXHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0ID0gb3V0bGV0O1xuXHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0LnNob3dpbmdNb2RhbCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5jYWxsUG9wU3RhdGUodGhpcy5jdXJyZW50T3V0bGV0LnBlZWtTdGF0ZSgpLCBmYWxzZSk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIF9iZWdpblBhZ2VOYXZpZ2F0aW9uKGZyYW1lOiBGcmFtZSk6IE5hdmlnYXRpb25PcHRpb25zIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5Ll9iZWdpblBhZ2VOYXZpZ2F0aW9uKCknKTtcblx0XHR9XG5cblx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSB0aGlzLmdldE91dGxldEJ5RnJhbWUoZnJhbWUpIHx8IHRoaXMuY3VycmVudE91dGxldDtcblx0XHRjb25zdCBsYXN0U3RhdGUgPSB0aGlzLmN1cnJlbnRPdXRsZXQucGVla1N0YXRlKCk7XG5cblx0XHRpZiAobGFzdFN0YXRlKSB7XG5cdFx0XHRsYXN0U3RhdGUuaXNQYWdlTmF2aWdhdGlvbiA9IHRydWU7XG5cdFx0fVxuXG5cdFx0Y29uc3QgbmF2T3B0aW9ucyA9IHRoaXMuX2N1cnJlbnROYXZpZ2F0aW9uT3B0aW9ucyB8fCBkZWZhdWx0TmF2T3B0aW9ucztcblx0XHRpZiAobmF2T3B0aW9ucy5jbGVhckhpc3RvcnkpIHtcblx0XHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ05TTG9jYXRpb25TdHJhdGVneS5fYmVnaW5QYWdlTmF2aWdhdGlvbiBjbGVhcmluZyBzdGF0ZXMgaGlzdG9yeScpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5jdXJyZW50T3V0bGV0LnN0YXRlcyA9IFtsYXN0U3RhdGVdO1xuXHRcdH1cblxuXHRcdHRoaXMuX2N1cnJlbnROYXZpZ2F0aW9uT3B0aW9ucyA9IHVuZGVmaW5lZDtcblx0XHRyZXR1cm4gbmF2T3B0aW9ucztcblx0fVxuXG5cdHB1YmxpYyBfc2V0TmF2aWdhdGlvbk9wdGlvbnMob3B0aW9uczogTmF2aWdhdGlvbk9wdGlvbnMpIHtcblx0XHR0aGlzLl9jdXJyZW50TmF2aWdhdGlvbk9wdGlvbnMgPSB7XG5cdFx0XHRjbGVhckhpc3Rvcnk6IGlzUHJlc2VudChvcHRpb25zLmNsZWFySGlzdG9yeSkgPyBvcHRpb25zLmNsZWFySGlzdG9yeSA6IGZhbHNlLFxuXHRcdFx0YW5pbWF0ZWQ6IGlzUHJlc2VudChvcHRpb25zLmFuaW1hdGVkKSA/IG9wdGlvbnMuYW5pbWF0ZWQgOiB0cnVlLFxuXHRcdFx0dHJhbnNpdGlvbjogb3B0aW9ucy50cmFuc2l0aW9uLFxuXHRcdH07XG5cblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5Ll9zZXROYXZpZ2F0aW9uT3B0aW9ucygnICsgYCR7SlNPTi5zdHJpbmdpZnkodGhpcy5fY3VycmVudE5hdmlnYXRpb25PcHRpb25zKX0pYCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIF9nZXRPdXRsZXRzKCk6IEFycmF5PE91dGxldD4ge1xuXHRcdHJldHVybiB0aGlzLm91dGxldHM7XG5cdH1cblxuXHR1cGRhdGVPdXRsZXRGcmFtZShvdXRsZXQ6IE91dGxldCwgZnJhbWU6IEZyYW1lLCBpc0VtcHR5T3V0bGV0RnJhbWU6IGJvb2xlYW4pIHtcblx0XHRjb25zdCBsYXN0U3RhdGUgPSBvdXRsZXQucGVla1N0YXRlKCk7XG5cblx0XHRpZiAobGFzdFN0YXRlICYmICFsYXN0U3RhdGUuZnJhbWUgJiYgIWlzRW1wdHlPdXRsZXRGcmFtZSkge1xuXHRcdFx0bGFzdFN0YXRlLmZyYW1lID0gZnJhbWU7XG5cdFx0fVxuXG5cdFx0aWYgKCFvdXRsZXQuY29udGFpbnNGcmFtZShmcmFtZSkpIHtcblx0XHRcdG91dGxldC5mcmFtZXMucHVzaChmcmFtZSk7XG5cdFx0fVxuXHRcdHRoaXMuY3VycmVudE91dGxldCA9IG91dGxldDtcblx0fVxuXG5cdGNsZWFyT3V0bGV0KGZyYW1lOiBGcmFtZSkge1xuXHRcdHRoaXMub3V0bGV0cyA9IHRoaXMub3V0bGV0cy5maWx0ZXIoKGN1cnJlbnRPdXRsZXQpID0+IHtcblx0XHRcdGxldCBpc0VxdWFsVG9DdXJyZW50O1xuXG5cdFx0XHRpZiAodGhpcy5jdXJyZW50T3V0bGV0KSB7XG5cdFx0XHRcdGlzRXF1YWxUb0N1cnJlbnQgPSBjdXJyZW50T3V0bGV0LnBhdGhCeU91dGxldHMgPT09IHRoaXMuY3VycmVudE91dGxldC5wYXRoQnlPdXRsZXRzO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmUgb3V0bGV0IGZyb20gdGhlIHVybCB0cmVlLlxuXHRcdFx0aWYgKGN1cnJlbnRPdXRsZXQuY29udGFpbnNGcmFtZShmcmFtZSkgJiYgIWlzRXF1YWxUb0N1cnJlbnQpIHtcblx0XHRcdFx0dGhpcy5jYWxsUG9wU3RhdGUobnVsbCwgdHJ1ZSwgY3VycmVudE91dGxldCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNraXAgZnJhbWVzIGZpbHRlcmluZyBzaW5jZSBjdXJyZW50T3V0bGV0IGlzIDxyb3V0ZXItb3V0bGV0PiB3aGVuIG5vIGZyYW1lcyBhdmFpbGFibGUuXG5cdFx0XHRpZiAoY3VycmVudE91dGxldC5mcmFtZXMubGVuZ3RoICYmICFjdXJyZW50T3V0bGV0LmlzTlNFbXB0eU91dGxldCkge1xuXHRcdFx0XHRjdXJyZW50T3V0bGV0LmZyYW1lcyA9IGN1cnJlbnRPdXRsZXQuZnJhbWVzLmZpbHRlcigoY3VycmVudEZyYW1lKSA9PiBjdXJyZW50RnJhbWUgIT09IGZyYW1lKTtcblx0XHRcdFx0cmV0dXJuIGN1cnJlbnRPdXRsZXQuZnJhbWVzLmxlbmd0aDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICFjdXJyZW50T3V0bGV0LmNvbnRhaW5zRnJhbWUoZnJhbWUpO1xuXHRcdH0pO1xuXHR9XG5cblx0Z2V0U2VnbWVudEdyb3VwRnVsbFBhdGgoc2VnbWVudEdyb3VwOiBVcmxTZWdtZW50R3JvdXApOiBzdHJpbmcge1xuXHRcdGxldCBmdWxsUGF0aCA9ICcnO1xuXG5cdFx0d2hpbGUgKHNlZ21lbnRHcm91cCkge1xuXHRcdFx0Y29uc3QgdXJsID0gc2VnbWVudEdyb3VwLnRvU3RyaW5nKCk7XG5cblx0XHRcdGlmIChmdWxsUGF0aCkge1xuXHRcdFx0XHRmdWxsUGF0aCA9ICh1cmwgPyB1cmwgKyAnLycgOiAnJykgKyBmdWxsUGF0aDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGxQYXRoID0gdXJsO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWdtZW50R3JvdXAgPSBzZWdtZW50R3JvdXAucGFyZW50O1xuXHRcdH1cblxuXHRcdHJldHVybiBmdWxsUGF0aDtcblx0fVxuXG5cdGdldFJvdXRlRnVsbFBhdGgoY3VycmVudFJvdXRlOiBhbnkpOiBzdHJpbmcge1xuXHRcdGNvbnN0IG91dGxldE5hbWUgPSBjdXJyZW50Um91dGUub3V0bGV0O1xuXHRcdGxldCBmdWxsUGF0aDtcblxuXHRcdGN1cnJlbnRSb3V0ZSA9IGN1cnJlbnRSb3V0ZS5wYXJlbnQ7XG5cdFx0d2hpbGUgKGN1cnJlbnRSb3V0ZSkge1xuXHRcdFx0Y29uc3QgdXJscyA9IGN1cnJlbnRSb3V0ZS51cmwudmFsdWUgfHwgY3VycmVudFJvdXRlLnVybDtcblx0XHRcdGxldCB1cmwgPSB1cmxzO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheSh1cmxzKSkge1xuXHRcdFx0XHR1cmwgPSB1cmwuam9pbignLycpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdWxsUGF0aCA9IGZ1bGxQYXRoID8gKHVybCA/IHVybCArICcvJyA6IHVybCkgKyBmdWxsUGF0aCA6IHVybDtcblx0XHRcdGN1cnJlbnRSb3V0ZSA9IGN1cnJlbnRSb3V0ZS5wYXJlbnQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZ1bGxQYXRoID8gZnVsbFBhdGggKyAnLScgKyBvdXRsZXROYW1lIDogb3V0bGV0TmFtZTtcblx0fVxuXG5cdGdldFBhdGhCeU91dGxldHModXJsU2VnbWVudEdyb3VwOiBhbnkpOiBzdHJpbmcge1xuXHRcdGlmICghdXJsU2VnbWVudEdyb3VwKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0bGV0IHBhdGhUb091dGxldDtcblx0XHRsZXQgbGFzdFBhdGggPSB1cmxTZWdtZW50R3JvdXAub3V0bGV0IHx8ICdwcmltYXJ5Jztcblx0XHRsZXQgcGFyZW50ID0gdXJsU2VnbWVudEdyb3VwLnBhcmVudDtcblxuXHRcdHdoaWxlIChwYXJlbnQgJiYgdXJsU2VnbWVudEdyb3VwLnJvb3QgIT09IHBhcmVudCkge1xuXHRcdFx0aWYgKHBhcmVudCAmJiBwYXJlbnQub3V0bGV0ICE9PSBsYXN0UGF0aCkge1xuXHRcdFx0XHRpZiAobGFzdFBhdGggPT09ICdwcmltYXJ5Jykge1xuXHRcdFx0XHRcdGxhc3RQYXRoID0gcGFyZW50Lm91dGxldDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRsYXN0UGF0aCA9IHBhcmVudC5vdXRsZXQ7XG5cdFx0XHRcdFx0cGF0aFRvT3V0bGV0ID0gbGFzdFBhdGggKyAnLScgKyAocGF0aFRvT3V0bGV0IHx8IHVybFNlZ21lbnRHcm91cC5vdXRsZXQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHBhdGhUb091dGxldCB8fCBsYXN0UGF0aDtcblx0fVxuXG5cdGZpbmRPdXRsZXQob3V0bGV0S2V5OiBzdHJpbmcsIGFjdGl2YXRlZFJvdXRlU25hcHNob3Q/OiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KTogT3V0bGV0IHtcblx0XHRsZXQgb3V0bGV0OiBPdXRsZXQgPSB0aGlzLm91dGxldHMuZmluZCgoY3VycmVudE91dGxldCkgPT4ge1xuXHRcdFx0bGV0IGVxdWFsTW9kYWxEZXB0aCA9IGN1cnJlbnRPdXRsZXQubW9kYWxOYXZpZ2F0aW9uRGVwdGggPT09IHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoO1xuXHRcdFx0cmV0dXJuIGVxdWFsTW9kYWxEZXB0aCAmJiBjdXJyZW50T3V0bGV0Lm91dGxldEtleXMuaW5kZXhPZihvdXRsZXRLZXkpID4gLTE7XG5cdFx0fSk7XG5cblx0XHQvLyBObyBPdXRsZXQgd2l0aCB0aGUgZ2l2ZW4gb3V0bGV0S2V5IGNvdWxkIGhhcHBlbiB3aGVuIHVzaW5nIG5lc3RlZCB1bm5hbWVkIHAtci1vXG5cdFx0Ly8gcHJpbWFyeSAtPiBwcmltYXJ5IC0+IHByeW1hcnlcblx0XHRpZiAoIW91dGxldCAmJiBhY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KSB7XG5cdFx0XHRjb25zdCBwYXRoQnlPdXRsZXRzID0gdGhpcy5nZXRQYXRoQnlPdXRsZXRzKGFjdGl2YXRlZFJvdXRlU25hcHNob3QpO1xuXHRcdFx0b3V0bGV0ID0gdGhpcy5vdXRsZXRzLmZpbmQoKGN1cnJlbnRPdXRsZXQpID0+IHtcblx0XHRcdFx0bGV0IGVxdWFsTW9kYWxEZXB0aCA9IGN1cnJlbnRPdXRsZXQubW9kYWxOYXZpZ2F0aW9uRGVwdGggPT09IHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoO1xuXHRcdFx0XHRyZXR1cm4gZXF1YWxNb2RhbERlcHRoICYmIGN1cnJlbnRPdXRsZXQucGF0aEJ5T3V0bGV0cyA9PT0gcGF0aEJ5T3V0bGV0cztcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRsZXQ7XG5cdH1cblxuXHRwcml2YXRlIGZpbmRPdXRsZXRCeU1vZGFsKG1vZGFsTmF2aWdhdGlvbjogbnVtYmVyLCBpc1Nob3dpbmdNb2RhbD86IGJvb2xlYW4pOiBPdXRsZXQge1xuXHRcdHJldHVybiB0aGlzLm91dGxldHMuZmluZCgob3V0bGV0KSA9PiB7XG5cdFx0XHRsZXQgZXF1YWxNb2RhbERlcHRoID0gb3V0bGV0Lm1vZGFsTmF2aWdhdGlvbkRlcHRoID09PSBtb2RhbE5hdmlnYXRpb247XG5cdFx0XHRyZXR1cm4gaXNTaG93aW5nTW9kYWwgPyBlcXVhbE1vZGFsRGVwdGggJiYgb3V0bGV0LnNob3dpbmdNb2RhbCA6IGVxdWFsTW9kYWxEZXB0aDtcblx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgZ2V0T3V0bGV0QnlGcmFtZShmcmFtZTogRnJhbWUpOiBPdXRsZXQge1xuXHRcdGxldCBvdXRsZXQ7XG5cblx0XHRmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5vdXRsZXRzLmxlbmd0aDsgaW5kZXgrKykge1xuXHRcdFx0Y29uc3QgY3VycmVudE91dGxldCA9IHRoaXMub3V0bGV0c1tpbmRleF07XG5cblx0XHRcdGlmIChjdXJyZW50T3V0bGV0LmNvbnRhaW5zRnJhbWUoZnJhbWUpKSB7XG5cdFx0XHRcdG91dGxldCA9IGN1cnJlbnRPdXRsZXQ7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBvdXRsZXQ7XG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZVN0YXRlcyhvdXRsZXQ6IE91dGxldCwgY3VycmVudFNlZ21lbnRHcm91cDogVXJsU2VnbWVudEdyb3VwLCBxdWVyeVBhcmFtczogUGFyYW1zKTogYm9vbGVhbiB7XG5cdFx0Y29uc3QgaXNOZXdQYWdlID0gb3V0bGV0LnN0YXRlcy5sZW5ndGggPT09IDA7XG5cdFx0Y29uc3QgbGFzdFN0YXRlID0gb3V0bGV0LnN0YXRlc1tvdXRsZXQuc3RhdGVzLmxlbmd0aCAtIDFdO1xuXHRcdGNvbnN0IGVxdWFsU3RhdGVVcmxzID0gb3V0bGV0LmNvbnRhaW5zVG9wU3RhdGUoY3VycmVudFNlZ21lbnRHcm91cC50b1N0cmluZygpKTtcblxuXHRcdGNvbnN0IGxvY2F0aW9uU3RhdGU6IExvY2F0aW9uU3RhdGUgPSB7XG5cdFx0XHRzZWdtZW50R3JvdXA6IGN1cnJlbnRTZWdtZW50R3JvdXAsXG5cdFx0XHRpc1Jvb3RTZWdtZW50R3JvdXA6IGZhbHNlLFxuXHRcdFx0aXNQYWdlTmF2aWdhdGlvbjogaXNOZXdQYWdlLFxuXHRcdFx0cXVlcnlQYXJhbXM6IHsgLi4ucXVlcnlQYXJhbXMgfSxcblx0XHR9O1xuXG5cdFx0aWYgKCFsYXN0U3RhdGUgfHwgIWVxdWFsU3RhdGVVcmxzKSB7XG5cdFx0XHRvdXRsZXQuc3RhdGVzLnB1c2gobG9jYXRpb25TdGF0ZSk7XG5cblx0XHRcdC8vIFVwZGF0ZSBsYXN0IHN0YXRlIHNlZ21lbnRHcm91cCBvZiBwYXJlbnQgT3V0bGV0LlxuXHRcdFx0aWYgKHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoID09PSAwICYmICFvdXRsZXQuc2hvd2luZ01vZGFsKSB7XG5cdFx0XHRcdHRoaXMudXBkYXRlUGFyZW50c1N0YXRlcyhvdXRsZXQsIGN1cnJlbnRTZWdtZW50R3JvdXAucGFyZW50KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cHJpdmF0ZSB1cGRhdGVQYXJlbnRzU3RhdGVzKG91dGxldDogT3V0bGV0LCBuZXdTZWdtZW50R3JvdXA6IFVybFNlZ21lbnRHcm91cCkge1xuXHRcdGxldCBwYXJlbnRPdXRsZXQgPSBvdXRsZXQucGFyZW50O1xuXG5cdFx0Ly8gVXBkYXRlIHBhcmVudHMgbGFzdFN0YXRlIHNlZ21lbnRHcm91cHNcblx0XHR3aGlsZSAocGFyZW50T3V0bGV0ICYmIG5ld1NlZ21lbnRHcm91cCkge1xuXHRcdFx0Y29uc3Qgc3RhdGUgPSBwYXJlbnRPdXRsZXQucGVla1N0YXRlKCk7XG5cblx0XHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0XHRzdGF0ZS5zZWdtZW50R3JvdXAgPSBuZXdTZWdtZW50R3JvdXA7XG5cdFx0XHRcdG5ld1NlZ21lbnRHcm91cCA9IG5ld1NlZ21lbnRHcm91cC5wYXJlbnQ7XG5cdFx0XHRcdHBhcmVudE91dGxldCA9IHBhcmVudE91dGxldC5wYXJlbnQ7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuXHRwcml2YXRlIGNyZWF0ZU91dGxldChvdXRsZXRLZXk6IHN0cmluZywgcGF0aDogc3RyaW5nLCBzZWdtZW50R3JvdXA6IGFueSwgcGFyZW50OiBPdXRsZXQsIG1vZGFsTmF2aWdhdGlvbj86IG51bWJlciwgcXVlcnlQYXJhbXM6IFBhcmFtcyA9IHt9KTogT3V0bGV0IHtcblx0XHRjb25zdCBwYXRoQnlPdXRsZXRzID0gdGhpcy5nZXRQYXRoQnlPdXRsZXRzKHNlZ21lbnRHcm91cCk7XG5cdFx0Y29uc3QgbmV3T3V0bGV0ID0gbmV3IE91dGxldChvdXRsZXRLZXksIHBhdGgsIHBhdGhCeU91dGxldHMsIG1vZGFsTmF2aWdhdGlvbik7XG5cblx0XHRjb25zdCBsb2NhdGlvblN0YXRlOiBMb2NhdGlvblN0YXRlID0ge1xuXHRcdFx0c2VnbWVudEdyb3VwOiBzZWdtZW50R3JvdXAsXG5cdFx0XHRpc1Jvb3RTZWdtZW50R3JvdXA6IGZhbHNlLFxuXHRcdFx0aXNQYWdlTmF2aWdhdGlvbjogdHJ1ZSwgLy8gSXQgaXMgYSBuZXcgT3V0bGV0Tm9kZS5cblx0XHRcdHF1ZXJ5UGFyYW1zOiB7IC4uLnF1ZXJ5UGFyYW1zIH0sXG5cdFx0fTtcblxuXHRcdG5ld091dGxldC5zdGF0ZXMgPSBbbG9jYXRpb25TdGF0ZV07XG5cdFx0bmV3T3V0bGV0LnBhcmVudCA9IHBhcmVudDtcblx0XHR0aGlzLm91dGxldHMucHVzaChuZXdPdXRsZXQpO1xuXG5cdFx0Ly8gVXBkYXRlIGxhc3Qgc3RhdGUgc2VnbWVudEdyb3VwIG9mIHBhcmVudCBPdXRsZXQuXG5cdFx0aWYgKHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoID09PSAwICYmICFuZXdPdXRsZXQuc2hvd2luZ01vZGFsKSB7XG5cdFx0XHR0aGlzLnVwZGF0ZVBhcmVudHNTdGF0ZXMobmV3T3V0bGV0LCBzZWdtZW50R3JvdXAucGFyZW50KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbmV3T3V0bGV0O1xuXHR9XG5cblx0cHJpdmF0ZSBnZXRTZWdtZW50R3JvdXBCeU91dGxldChvdXRsZXQ6IE91dGxldCk6IFVybFNlZ21lbnRHcm91cCB7XG5cdFx0Y29uc3QgcGF0aExpc3QgPSBvdXRsZXQucGF0aEJ5T3V0bGV0cy5zcGxpdCgnLScpO1xuXHRcdGxldCBzZWdtZW50R3JvdXAgPSB0aGlzLmN1cnJlbnRVcmxUcmVlLnJvb3Q7XG5cdFx0bGV0IHBhdGhUb091dGxldDtcblxuXHRcdGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBwYXRoTGlzdC5sZW5ndGg7IGluZGV4KyspIHtcblx0XHRcdGNvbnN0IGN1cnJlbnRQYXRoID0gcGF0aExpc3RbaW5kZXhdO1xuXHRcdFx0Y29uc3QgY2hpbGRyZW5Db3VudCA9IE9iamVjdC5rZXlzKHNlZ21lbnRHcm91cC5jaGlsZHJlbikubGVuZ3RoO1xuXG5cdFx0XHRpZiAoY2hpbGRyZW5Db3VudCAmJiBzZWdtZW50R3JvdXAuY2hpbGRyZW5bY3VycmVudFBhdGhdKSB7XG5cdFx0XHRcdGNvbnN0IHVybCA9IHNlZ21lbnRHcm91cC50b1N0cmluZygpO1xuXHRcdFx0XHRwYXRoVG9PdXRsZXQgPSBwYXRoVG9PdXRsZXQgPyBwYXRoVG9PdXRsZXQgKyAnLycgKyB1cmwgOiB1cmw7XG5cdFx0XHRcdHNlZ21lbnRHcm91cCA9IHNlZ21lbnRHcm91cC5jaGlsZHJlbltjdXJyZW50UGF0aF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBJZiBubyBjaGlsZCBvdXRsZXQgZm91bmQgd2l0aCB0aGUgZ2l2ZW4gbmFtZSAtIGZvcmdldCBhYm91dCBhbGwgcHJldmlvdXNseSBmb3VuZCBvdXRsZXRzLlxuXHRcdFx0XHQvLyBleGFtcGxlOiBzZWFjaGluZyBmb3IgJ3ByaW1hcnktc2Vjb25kLXByaW1hcnknIHNob3VsZG4ndCByZXR1cm4gJ3ByaW1hcnktc2Vjb25kJ1xuXHRcdFx0XHQvLyBpZiBubyAncHJpbWFyeScgY2hpbGQgYXZhaWxhYmxlIG9uICdzZWNvbmQnLlxuXHRcdFx0XHRzZWdtZW50R3JvdXAgPSBudWxsO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBQYXRocyBzaG91bGQgYWxzbyBtYXRjaCBzaW5jZSB0aGVyZSBjb3VsZCBiZSBhbm90aGVyIE91dGxldFxuXHRcdC8vIHdpdGggdGhlIHNhbWUgcGF0aEJ5T3V0bGV0cyBidXQgZGlmZmVyZW50IHVybCBwYXRoLlxuXHRcdGlmIChzZWdtZW50R3JvdXAgJiYgb3V0bGV0LnBhdGggJiYgcGF0aFRvT3V0bGV0ICYmIG91dGxldC5wYXRoICE9PSBwYXRoVG9PdXRsZXQpIHtcblx0XHRcdHNlZ21lbnRHcm91cCA9IG51bGw7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlZ21lbnRHcm91cDtcblx0fVxuXG5cdC8vIFRyYXZlcnNhbCBhbmQgcmVwbGFjZW1lbnQgb2Ygc2VnbWVudEdyb3VwLlxuXHRwcml2YXRlIHVwZGF0ZVNlZ21lbnRHcm91cChyb290Tm9kZTogYW55LCBvbGRTZWdtZW50R3JvdXA6IFVybFNlZ21lbnRHcm91cCwgbmV3U2VnbWVudEdyb3VwOiBVcmxTZWdtZW50R3JvdXApIHtcblx0XHRjb25zdCBxdWV1ZSA9IFtdO1xuXHRcdGxldCBjdXJyZW50VHJlZSA9IHJvb3ROb2RlO1xuXG5cdFx0d2hpbGUgKGN1cnJlbnRUcmVlKSB7XG5cdFx0XHRPYmplY3Qua2V5cyhjdXJyZW50VHJlZS5jaGlsZHJlbikuZm9yRWFjaCgob3V0bGV0TmFtZSkgPT4ge1xuXHRcdFx0XHRpZiAoY3VycmVudFRyZWUuY2hpbGRyZW5bb3V0bGV0TmFtZV0gPT09IG9sZFNlZ21lbnRHcm91cCkge1xuXHRcdFx0XHRcdGlmIChuZXdTZWdtZW50R3JvdXApIHtcblx0XHRcdFx0XHRcdGN1cnJlbnRUcmVlLmNoaWxkcmVuW291dGxldE5hbWVdID0gbmV3U2VnbWVudEdyb3VwO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRkZWxldGUgY3VycmVudFRyZWUuY2hpbGRyZW5bb3V0bGV0TmFtZV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHF1ZXVlLnB1c2goY3VycmVudFRyZWUuY2hpbGRyZW5bb3V0bGV0TmFtZV0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdGN1cnJlbnRUcmVlID0gcXVldWUuc2hpZnQoKTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHVwc2VydE1vZGFsT3V0bGV0KHBhcmVudE91dGxldDogT3V0bGV0LCBzZWdtZW50ZWRHcm91cDogVXJsU2VnbWVudEdyb3VwLCBxdWVyeVBhcmFtczogUGFyYW1zKSB7XG5cdFx0bGV0IGN1cnJlbnRNb2RhbE91dGxldCA9IHRoaXMuZmluZE91dGxldEJ5TW9kYWwodGhpcy5fbW9kYWxOYXZpZ2F0aW9uRGVwdGgpO1xuXG5cdFx0Ly8gV2Ugd2FudCB0byB0cmVhdCBldmVyeSBwLXItbyBhcyBhIHN0YW5kYWxvbmUgT3V0bGV0LlxuXHRcdGlmICghY3VycmVudE1vZGFsT3V0bGV0KSB7XG5cdFx0XHRpZiAodGhpcy5fbW9kYWxOYXZpZ2F0aW9uRGVwdGggPiAxKSB7XG5cdFx0XHRcdC8vIFRoZSBwYXJlbnQgb2YgdGhlIGN1cnJlbnQgT3V0bGV0IHNob3VsZCBiZSB0aGUgcHJldmlvdXMgb3BlbmVkIG1vZGFsIChpZiBhbnkpLlxuXHRcdFx0XHRwYXJlbnRPdXRsZXQgPSB0aGlzLmZpbmRPdXRsZXRCeU1vZGFsKHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoIC0gMSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vIGN1cnJlbnRNb2RhbE91dGxldCBhdmFpbGFibGUgd2hlbiBvcGVuaW5nICdwcmltYXJ5JyBwLXItby5cblx0XHRcdGNvbnN0IG91dGxldE5hbWUgPSAncHJpbWFyeSc7XG5cdFx0XHRjb25zdCBvdXRsZXRQYXRoID0gcGFyZW50T3V0bGV0LnBlZWtTdGF0ZSgpLnNlZ21lbnRHcm91cC50b1N0cmluZygpO1xuXHRcdFx0Y29uc3Qgb3V0bGV0S2V5ID0gdGhpcy5nZXRPdXRsZXRLZXkob3V0bGV0UGF0aCwgb3V0bGV0TmFtZSk7XG5cdFx0XHQvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG5cdFx0XHRjdXJyZW50TW9kYWxPdXRsZXQgPSB0aGlzLmNyZWF0ZU91dGxldChvdXRsZXRLZXksIG91dGxldFBhdGgsIHNlZ21lbnRlZEdyb3VwLCBwYXJlbnRPdXRsZXQsIHRoaXMuX21vZGFsTmF2aWdhdGlvbkRlcHRoLCBxdWVyeVBhcmFtcyk7XG5cdFx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSBjdXJyZW50TW9kYWxPdXRsZXQ7XG5cdFx0fSBlbHNlIGlmICh0aGlzLnVwZGF0ZVN0YXRlcyhjdXJyZW50TW9kYWxPdXRsZXQsIHNlZ21lbnRlZEdyb3VwLCBxdWVyeVBhcmFtcykpIHtcblx0XHRcdHRoaXMuY3VycmVudE91dGxldCA9IGN1cnJlbnRNb2RhbE91dGxldDsgLy8gSWYgc3RhdGVzIHVwZGF0ZWRcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGdldE91dGxldEtleShwYXRoOiBzdHJpbmcsIG91dGxldE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHBhdGggPyBwYXRoICsgJy0nICsgb3V0bGV0TmFtZSA6IG91dGxldE5hbWU7XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpIHtcblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnTlNMb2NhdGlvblN0cmF0ZWd5Lm5nT25EZXN0cm95KCknKTtcblx0XHR9XG5cblx0XHR0aGlzLm91dGxldHMgPSBbXTtcblx0XHR0aGlzLmN1cnJlbnRPdXRsZXQgPSBudWxsO1xuXHR9XG59XG4iXX0=