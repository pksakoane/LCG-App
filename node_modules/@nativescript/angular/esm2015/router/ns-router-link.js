import { Directive, Input, ElementRef, NgZone } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { NativeScriptDebug } from '../trace';
import { RouterExtensions } from './router-extensions';
/**
 * The nsRouterLink directive lets you link to specific parts of your app.
 *
 * Consider the following route configuration:
 * ```
 * [{ path: "/user", component: UserCmp }]
 * ```
 *
 * When linking to this `User` route, you can write:
 *
 * ```
 * <a [nsRouterLink]="["/user"]">link to user component</a>
 * ```
 *
 * NSRouterLink expects the value to be an array of path segments, followed by the params
 * for that level of routing. For instance `["/team", {teamId: 1}, "user", {userId: 2}]`
 * means that we want to generate a link to `/team;teamId=1/user;userId=2`.
 *
 * The first segment name can be prepended with `/`, `./`, or `../`.
 * If the segment begins with `/`, the router will look up the route from the root of the app.
 * If the segment begins with `./`, or doesn"t begin with a slash, the router will
 * instead look in the current component"s children for the route.
 * And if the segment begins with `../`, the router will go up one level.
 */
export class NSRouterLink {
    constructor(ngZone, router, navigator, route, el) {
        this.ngZone = ngZone;
        this.router = router;
        this.navigator = navigator;
        this.route = route;
        this.el = el;
        this.pageTransition = true;
        this.commands = [];
    }
    ngAfterViewInit() {
        this.el.nativeElement.on('tap', () => {
            this.ngZone.run(() => {
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.routerLog(`nsRouterLink.tapped: ${this.commands} ` + `clear: ${this.clearHistory} ` + `transition: ${JSON.stringify(this.pageTransition)} ` + `duration: ${this.pageTransitionDuration}`);
                }
                const extras = this.getExtras();
                // this.navigator.navigateByUrl(this.urlTree, extras);
                this.navigator.navigate(this.commands, Object.assign(Object.assign({}, extras), { relativeTo: this.route, queryParams: this.queryParams, fragment: this.fragment, queryParamsHandling: this.queryParamsHandling, preserveFragment: attrBoolValue(this.preserveFragment) }));
            });
        });
    }
    set params(data) {
        if (Array.isArray(data)) {
            this.commands = data;
        }
        else {
            this.commands = [data];
        }
    }
    getExtras() {
        const transition = this.getTransition();
        return {
            skipLocationChange: attrBoolValue(this.skipLocationChange),
            replaceUrl: attrBoolValue(this.replaceUrl),
            clearHistory: this.convertClearHistory(this.clearHistory),
            animated: transition.animated,
            transition: transition.transition,
        };
    }
    get urlTree() {
        const urlTree = this.router.createUrlTree(this.commands, {
            relativeTo: this.route,
            queryParams: this.queryParams,
            fragment: this.fragment,
            queryParamsHandling: this.queryParamsHandling,
            preserveFragment: attrBoolValue(this.preserveFragment),
        });
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`nsRouterLink urlTree created: ${urlTree}`);
        }
        return urlTree;
    }
    convertClearHistory(value) {
        return value === true || value === 'true';
    }
    getTransition() {
        let transition;
        let animated;
        if (typeof this.pageTransition === 'boolean') {
            animated = this.pageTransition;
        }
        else if (typeof this.pageTransition === 'string') {
            if (this.pageTransition === 'none' || this.pageTransition === 'false') {
                animated = false;
            }
            else {
                animated = true;
                transition = {
                    name: this.pageTransition,
                };
            }
        }
        else {
            animated = true;
            transition = this.pageTransition;
        }
        let duration = +this.pageTransitionDuration;
        if (!isNaN(duration)) {
            transition = transition || {};
            transition.duration = duration;
        }
        return { animated, transition };
    }
}
NSRouterLink.decorators = [
    { type: Directive, args: [{ selector: '[nsRouterLink]' },] }
];
NSRouterLink.ctorParameters = () => [
    { type: NgZone },
    { type: Router },
    { type: RouterExtensions },
    { type: ActivatedRoute },
    { type: ElementRef }
];
NSRouterLink.propDecorators = {
    target: [{ type: Input }],
    queryParams: [{ type: Input }],
    fragment: [{ type: Input }],
    queryParamsHandling: [{ type: Input }],
    preserveQueryParams: [{ type: Input }],
    preserveFragment: [{ type: Input }],
    skipLocationChange: [{ type: Input }],
    replaceUrl: [{ type: Input }],
    clearHistory: [{ type: Input }],
    pageTransition: [{ type: Input }],
    pageTransitionDuration: [{ type: Input }],
    params: [{ type: Input, args: ['nsRouterLink',] }]
};
function attrBoolValue(s) {
    return s === '' || !!s;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnMtcm91dGVyLWxpbmsuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vIiwic291cmNlcyI6WyJyb3V0ZXIvbnMtcm91dGVyLWxpbmsudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBVyxNQUFNLGlCQUFpQixDQUFDO0FBRWxFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQU12RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFFSCxNQUFNLE9BQU8sWUFBWTtJQWtCeEIsWUFBb0IsTUFBYyxFQUFVLE1BQWMsRUFBVSxTQUEyQixFQUFVLEtBQXFCLEVBQVUsRUFBYztRQUFsSSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBTDdJLG1CQUFjLEdBQTRDLElBQUksQ0FBQztRQUdoRSxhQUFRLEdBQVUsRUFBRSxDQUFDO0lBRTRILENBQUM7SUFFMUosZUFBZTtRQUNkLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtnQkFDcEIsSUFBSSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsRUFBRTtvQkFDckMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLHdCQUF3QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsVUFBVSxJQUFJLENBQUMsWUFBWSxHQUFHLEdBQUcsZUFBZSxJ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YztpQkFDakMsQ0FBQzthQUNGO1NBQ0Q7YUFBTTtZQUNOLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDaEIsVUFBVSxHQUF5QixJQUFJLENBQUMsY0FBYyxDQUFDO1NBQ3ZEO1FBRUQsSUFBSSxRQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUM7UUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNyQixVQUFVLEdBQUcsVUFBVSxJQUFJLEVBQUUsQ0FBQztZQUM5QixVQUFVLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztTQUMvQjtRQUVELE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLENBQUM7SUFDakMsQ0FBQzs7O1lBOUdELFNBQVMsU0FBQyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRTs7O1lBbkNGLE1BQU07WUFFcEIsTUFBTTtZQUd0QixnQkFBZ0I7WUFIaEIsY0FBYztZQUZJLFVBQVU7OztxQkFzQ25DLEtBQUs7MEJBQ0wsS0FBSzt1QkFDTCxLQUFLO2tDQUVMLEtBQUs7a0NBQ0wsS0FBSzsrQkFDTCxLQUFLO2lDQUNMLEtBQUs7eUJBQ0wsS0FBSzsyQkFFTCxLQUFLOzZCQUNMLEtBQUs7cUNBQ0wsS0FBSztxQkEyQkwsS0FBSyxTQUFDLGNBQWM7O0FBdUV0QixTQUFTLGFBQWEsQ0FBQyxDQUFNO0lBQzVCLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBFbGVtZW50UmVmLCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5hdmlnYXRpb25FeHRyYXMgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciwgVXJsVHJlZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uVHJhbnNpdGlvbiB9IGZyb20gJ0BuYXRpdmVzY3JpcHQvY29yZSc7XG5pbXBvcnQgeyBOYXRpdmVTY3JpcHREZWJ1ZyB9IGZyb20gJy4uL3RyYWNlJztcbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tICcuL3JvdXRlci1leHRlbnNpb25zJztcbmltcG9ydCB7IE5hdmlnYXRpb25PcHRpb25zIH0gZnJvbSAnLi9ucy1sb2NhdGlvbi11dGlscyc7XG5cbi8vIENvcGllZCBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyL3NyYy9jb25maWdcIlxuZXhwb3J0IHR5cGUgUXVlcnlQYXJhbXNIYW5kbGluZyA9ICdtZXJnZScgfCAncHJlc2VydmUnIHwgJyc7XG5cbi8qKlxuICogVGhlIG5zUm91dGVyTGluayBkaXJlY3RpdmUgbGV0cyB5b3UgbGluayB0byBzcGVjaWZpYyBwYXJ0cyBvZiB5b3VyIGFwcC5cbiAqXG4gKiBDb25zaWRlciB0aGUgZm9sbG93aW5nIHJvdXRlIGNvbmZpZ3VyYXRpb246XG4gKiBgYGBcbiAqIFt7IHBhdGg6IFwiL3VzZXJcIiwgY29tcG9uZW50OiBVc2VyQ21wIH1dXG4gKiBgYGBcbiAqXG4gKiBXaGVuIGxpbmtpbmcgdG8gdGhpcyBgVXNlcmAgcm91dGUsIHlvdSBjYW4gd3JpdGU6XG4gKlxuICogYGBgXG4gKiA8YSBbbnNSb3V0ZXJMaW5rXT1cIltcIi91c2VyXCJdXCI+bGluayB0byB1c2VyIGNvbXBvbmVudDwvYT5cbiAqIGBgYFxuICpcbiAqIE5TUm91dGVyTGluayBleHBlY3RzIHRoZSB2YWx1ZSB0byBiZSBhbiBhcnJheSBvZiBwYXRoIHNlZ21lbnRzLCBmb2xsb3dlZCBieSB0aGUgcGFyYW1zXG4gKiBmb3IgdGhhdCBsZXZlbCBvZiByb3V0aW5nLiBGb3IgaW5zdGFuY2UgYFtcIi90ZWFtXCIsIHt0ZWFtSWQ6IDF9LCBcInVzZXJcIiwge3VzZXJJZDogMn1dYFxuICogbWVhbnMgdGhhdCB3ZSB3YW50IHRvIGdlbmVyYXRlIGEgbGluayB0byBgL3RlYW07dGVhbUlkPTEvdXNlcjt1c2VySWQ9MmAuXG4gKlxuICogVGhlIGZpcnN0IHNlZ21lbnQgbmFtZSBjYW4gYmUgcHJlcGVuZGVkIHdpdGggYC9gLCBgLi9gLCBvciBgLi4vYC5cbiAqIElmIHRoZSBzZWdtZW50IGJlZ2lucyB3aXRoIGAvYCwgdGhlIHJvdXRlciB3aWxsIGxvb2sgdXAgdGhlIHJvdXRlIGZyb20gdGhlIHJvb3Qgb2YgdGhlIGFwcC5cbiAqIElmIHRoZSBzZWdtZW50IGJlZ2lucyB3aXRoIGAuL2AsIG9yIGRvZXNuXCJ0IGJlZ2luIHdpdGggYSBzbGFzaCwgdGhlIHJvdXRlciB3aWxsXG4gKiBpbnN0ZWFkIGxvb2sgaW4gdGhlIGN1cnJlbnQgY29tcG9uZW50XCJzIGNoaWxkcmVuIGZvciB0aGUgcm91dGUuXG4gKiBBbmQgaWYgdGhlIHNlZ21lbnQgYmVnaW5zIHdpdGggYC4uL2AsIHRoZSByb3V0ZXIgd2lsbCBnbyB1cCBvbmUgbGV2ZWwuXG4gKi9cbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1tuc1JvdXRlckxpbmtdJyB9KVxuZXhwb3J0IGNsYXNzIE5TUm91dGVyTGluayB7XG5cdC8vIHRzbGludDpkaXNhYmxlLWxpbmU6ZGlyZWN0aXZlLWNsYXNzLXN1ZmZpeFxuXHRASW5wdXQoKSB0YXJnZXQ6IHN0cmluZztcblx0QElucHV0KCkgcXVlcnlQYXJhbXM6IHsgW2s6IHN0cmluZ106IGFueSB9O1xuXHRASW5wdXQoKSBmcmFnbWVudDogc3RyaW5nO1xuXG5cdEBJbnB1dCgpIHF1ZXJ5UGFyYW1zSGFuZGxpbmc6IFF1ZXJ5UGFyYW1zSGFuZGxpbmc7XG5cdEBJbnB1dCgpIHByZXNlcnZlUXVlcnlQYXJhbXM6IGJvb2xlYW47XG5cdEBJbnB1dCgpIHByZXNlcnZlRnJhZ21lbnQ6IGJvb2xlYW47XG5cdEBJbnB1dCgpIHNraXBMb2NhdGlvbkNoYW5nZTogYm9vbGVhbjtcblx0QElucHV0KCkgcmVwbGFjZVVybDogYm9vbGVhbjtcblxuXHRASW5wdXQoKSBjbGVhckhpc3Rvcnk6IGJvb2xlYW47XG5cdEBJbnB1dCgpIHBhZ2VUcmFuc2l0aW9uOiBib29sZWFuIHwgc3RyaW5nIHwgTmF2aWdhdGlvblRyYW5zaXRpb24gPSB0cnVlO1xuXHRASW5wdXQoKSBwYWdlVHJhbnNpdGlvbkR1cmF0aW9uO1xuXG5cdHByaXZhdGUgY29tbWFuZHM6IGFueVtdID0gW107XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBuYXZpZ2F0b3I6IFJvdXRlckV4dGVuc2lvbnMsIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmKSB7fVxuXG5cdG5nQWZ0ZXJWaWV3SW5pdCgpIHtcblx0XHR0aGlzLmVsLm5hdGl2ZUVsZW1lbnQub24oJ3RhcCcsICgpID0+IHtcblx0XHRcdHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG5cdFx0XHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZyhgbnNSb3V0ZXJMaW5rLnRhcHBlZDogJHt0aGlzLmNvbW1hbmRzfSBgICsgYGNsZWFyOiAke3RoaXMuY2xlYXJIaXN0b3J5fSBgICsgYHRyYW5zaXRpb246ICR7SlNPTi5zdHJpbmdpZnkodGhpcy5wYWdlVHJhbnNpdGlvbil9IGAgKyBgZHVyYXRpb246ICR7dGhpcy5wYWdlVHJhbnNpdGlvbkR1cmF0aW9ufWApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc3QgZXh0cmFzID0gdGhpcy5nZXRFeHRyYXMoKTtcblx0XHRcdFx0Ly8gdGhpcy5uYXZpZ2F0b3IubmF2aWdhdGVCeVVybCh0aGlzLnVybFRyZWUsIGV4dHJhcyk7XG5cdFx0XHRcdHRoaXMubmF2aWdhdG9yLm5hdmlnYXRlKHRoaXMuY29tbWFuZHMsIHtcblx0XHRcdFx0XHQuLi5leHRyYXMsXG5cdFx0XHRcdFx0cmVsYXRpdmVUbzogdGhpcy5yb3V0ZSxcblx0XHRcdFx0XHRxdWVyeVBhcmFtczogdGhpcy5xdWVyeVBhcmFtcyxcblx0XHRcdFx0XHRmcmFnbWVudDogdGhpcy5mcmFnbWVudCxcblx0XHRcdFx0XHRxdWVyeVBhcmFtc0hhbmRsaW5nOiB0aGlzLnF1ZXJ5UGFyYW1zSGFuZGxpbmcsXG5cdFx0XHRcdFx0cHJlc2VydmVGcmFnbWVudDogYXR0ckJvb2xWYWx1ZSh0aGlzLnByZXNlcnZlRnJhZ21lbnQpLFxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0QElucHV0KCduc1JvdXRlckxpbmsnKVxuXHRzZXQgcGFyYW1zKGRhdGE6IGFueVtdIHwgc3RyaW5nKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcblx0XHRcdHRoaXMuY29tbWFuZHMgPSBkYXRhO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmNvbW1hbmRzID0gW2RhdGFdO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZ2V0RXh0cmFzKCk6IE5hdmlnYXRpb25FeHRyYXMgJiBOYXZpZ2F0aW9uT3B0aW9ucyB7XG5cdFx0Y29uc3QgdHJhbnNpdGlvbiA9IHRoaXMuZ2V0VHJhbnNpdGlvbigpO1xuXHRcdHJldHVybiB7XG5cdFx0XHRza2lwTG9jYXRpb25DaGFuZ2U6IGF0dHJCb29sVmFsdWUodGhpcy5za2lwTG9jYXRpb25DaGFuZ2UpLFxuXHRcdFx0cmVwbGFjZVVybDogYXR0ckJvb2xWYWx1ZSh0aGlzLnJlcGxhY2VVcmwpLFxuXG5cdFx0XHRjbGVhckhpc3Rvcnk6IHRoaXMuY29udmVydENsZWFySGlzdG9yeSh0aGlzLmNsZWFySGlzdG9yeSksXG5cdFx0XHRhbmltYXRlZDogdHJhbnNpdGlvbi5hbmltYXRlZCxcblx0XHRcdHRyYW5zaXRpb246IHRyYW5zaXRpb24udHJhbnNpdGlvbixcblx0XHR9O1xuXHR9XG5cblx0Z2V0IHVybFRyZWUoKTogVXJsVHJlZSB7XG5cdFx0Y29uc3QgdXJsVHJlZSA9IHRoaXMucm91dGVyLmNyZWF0ZVVybFRyZWUodGhpcy5jb21tYW5kcywge1xuXHRcdFx0cmVsYXRpdmVUbzogdGhpcy5yb3V0ZSxcblx0XHRcdHF1ZXJ5UGFyYW1zOiB0aGlzLnF1ZXJ5UGFyYW1zLFxuXHRcdFx0ZnJhZ21lbnQ6IHRoaXMuZnJhZ21lbnQsXG5cdFx0XHRxdWVyeVBhcmFtc0hhbmRsaW5nOiB0aGlzLnF1ZXJ5UGFyYW1zSGFuZGxpbmcsXG5cdFx0XHRwcmVzZXJ2ZUZyYWdtZW50OiBhdHRyQm9vbFZhbHVlKHRoaXMucHJlc2VydmVGcmFnbWVudCksXG5cdFx0fSk7XG5cblx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZyhgbnNSb3V0ZXJMaW5rIHVybFRyZWUgY3JlYXRlZDogJHt1cmxUcmVlfWApO1xuXHRcdH1cblxuXHRcdHJldHVybiB1cmxUcmVlO1xuXHR9XG5cblx0cHJpdmF0ZSBjb252ZXJ0Q2xlYXJIaXN0b3J5KHZhbHVlOiBib29sZWFuIHwgc3RyaW5nKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSAndHJ1ZSc7XG5cdH1cblxuXHRwcml2YXRlIGdldFRyYW5zaXRpb24oKTogeyBhbmltYXRlZDogYm9vbGVhbjsgdHJhbnNpdGlvbj86IE5hdmlnYXRpb25UcmFuc2l0aW9uIH0ge1xuXHRcdGxldCB0cmFuc2l0aW9uOiBOYXZpZ2F0aW9uVHJhbnNpdGlvbjtcblx0XHRsZXQgYW5pbWF0ZWQ6IGJvb2xlYW47XG5cblx0XHRpZiAodHlwZW9mIHRoaXMucGFnZVRyYW5zaXRpb24gPT09ICdib29sZWFuJykge1xuXHRcdFx0YW5pbWF0ZWQgPSB0aGlzLnBhZ2VUcmFuc2l0aW9uO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIHRoaXMucGFnZVRyYW5zaXRpb24gPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAodGhpcy5wYWdlVHJhbnNpdGlvbiA9PT0gJ25vbmUnIHx8IHRoaXMucGFnZVRyYW5zaXRpb24gPT09ICdmYWxzZScpIHtcblx0XHRcdFx0YW5pbWF0ZWQgPSBmYWxzZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGFuaW1hdGVkID0gdHJ1ZTtcblx0XHRcdFx0dHJhbnNpdGlvbiA9IHtcblx0XHRcdFx0XHRuYW1lOiA8c3RyaW5nPnRoaXMucGFnZVRyYW5zaXRpb24sXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGFuaW1hdGVkID0gdHJ1ZTtcblx0XHRcdHRyYW5zaXRpb24gPSA8TmF2aWdhdGlvblRyYW5zaXRpb24+dGhpcy5wYWdlVHJhbnNpdGlvbjtcblx0XHR9XG5cblx0XHRsZXQgZHVyYXRpb24gPSArdGhpcy5wYWdlVHJhbnNpdGlvbkR1cmF0aW9uO1xuXHRcdGlmICghaXNOYU4oZHVyYXRpb24pKSB7XG5cdFx0XHR0cmFuc2l0aW9uID0gdHJhbnNpdGlvbiB8fCB7fTtcblx0XHRcdHRyYW5zaXRpb24uZHVyYXRpb24gPSBkdXJhdGlvbjtcblx0XHR9XG5cblx0XHRyZXR1cm4geyBhbmltYXRlZCwgdHJhbnNpdGlvbiB9O1xuXHR9XG59XG5cbmZ1bmN0aW9uIGF0dHJCb29sVmFsdWUoczogYW55KTogYm9vbGVhbiB7XG5cdHJldHVybiBzID09PSAnJyB8fCAhIXM7XG59XG4iXX0=